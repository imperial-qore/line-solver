{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.113666Z",
          "start_time": "2025-07-29T11:13:52.130760Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.058862Z",
          "iopub.execute_input": "2026-01-01T10:32:16.058962Z",
          "iopub.status.idle": "2026-01-01T10:32:16.536701Z",
          "shell.execute_reply": "2026-01-01T10:32:16.536389Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "# Create network\nmodel = Network('model')\n\n# Block 1: nodes\nnode1 = Delay(model, 'Delay')\nnode2 = Queue(model, 'Queue1', SchedStrategy.PS)\nnode3 = Queue(model, 'Queue2', SchedStrategy.PS)\nnode3.set_number_of_servers(2)  # Queue2 has 2 servers",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.189257Z",
          "start_time": "2025-07-29T11:13:53.180708Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.537937Z",
          "iopub.execute_input": "2026-01-01T10:32:16.538119Z",
          "iopub.status.idle": "2026-01-01T10:32:16.540139Z",
          "shell.execute_reply": "2026-01-01T10:32:16.539825Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "# Block 2: classes\nN = [1, 0, 3, 0]  # Population for each class\njobclass1 = ClosedClass(model, 'Class1', N[0], node1, 0)\njobclass2 = ClosedClass(model, 'Class2', N[1], node1, 0)\njobclass3 = ClosedClass(model, 'Class3', N[2], node1, 0)\njobclass4 = ClosedClass(model, 'Class4', N[3], node1, 0)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.234776Z",
          "start_time": "2025-07-29T11:13:53.228375Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.540844Z",
          "iopub.execute_input": "2026-01-01T10:32:16.540954Z",
          "shell.execute_reply": "2026-01-01T10:32:16.542336Z",
          "iopub.status.idle": "2026-01-01T10:32:16.542514Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "# Set service times for all stations\n# Delay\nnode1.set_service(jobclass1, Exp.fit_mean(1.0))\nnode1.set_service(jobclass2, Exp.fit_mean(1.0/2.0))\nnode1.set_service(jobclass3, Exp.fit_mean(1.0))\nnode1.set_service(jobclass4, Exp.fit_mean(1.0))\n\n# Queue1\nnode2.set_service(jobclass1, Exp.fit_mean(1.0/3.0))\nnode2.set_service(jobclass2, Exp.fit_mean(1.0/4.0))\nnode2.set_service(jobclass3, Exp.fit_mean(1.0/5.0))\nnode2.set_service(jobclass4, Exp.fit_mean(1.0))\n\n# Queue2\nnode3.set_service(jobclass1, Exp.fit_mean(1.0))\nnode3.set_service(jobclass2, Exp.fit_mean(1.0/3.0))\nnode3.set_service(jobclass3, Exp.fit_mean(1.0/5.0))\nnode3.set_service(jobclass4, Exp.fit_mean(1.0/2.0))",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.293548Z",
          "start_time": "2025-07-29T11:13:53.287579Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.543238Z",
          "iopub.execute_input": "2026-01-01T10:32:16.543308Z",
          "shell.execute_reply": "2026-01-01T10:32:16.544890Z",
          "iopub.status.idle": "2026-01-01T10:32:16.545102Z"
        }
      },
      "outputs": [],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Block 3: routing with class switching\nRT = model.init_routing_matrix()\n\n# Set up the routing matrix with class switching\nnodes = [node1, node2, node3]\njobclasses = [jobclass1, jobclass2, jobclass3, jobclass4]\n\n# Class1 routing: Delay -> Queue1 -> Queue2 -> switch to Class2\nRT.set(jobclass1, jobclass1, node1, node2, 1.0)  # Delay -> Queue1\nRT.set(jobclass1, jobclass1, node2, node3, 1.0)  # Queue1 -> Queue2\nRT.set(jobclass1, jobclass2, node3, node1, 1.0)  # Queue2 -> Delay (switch to Class2)\n\n# Class2 routing: Delay -> Queue1 -> Queue2 -> switch to Class1\nRT.set(jobclass2, jobclass2, node1, node2, 1.0)  # Delay -> Queue1\nRT.set(jobclass2, jobclass2, node2, node3, 1.0)  # Queue1 -> Queue2\nRT.set(jobclass2, jobclass1, node3, node1, 1.0)  # Queue2 -> Delay (switch to Class1)\n\n# Class3 routing: Delay -> Queue1 -> Queue2 -> switch to Class4\nRT.set(jobclass3, jobclass3, node1, node2, 1.0)  # Delay -> Queue1\nRT.set(jobclass3, jobclass3, node2, node3, 1.0)  # Queue1 -> Queue2\nRT.set(jobclass3, jobclass4, node3, node1, 1.0)  # Queue2 -> Delay (switch to Class4)\n\n# Class4 routing: Delay -> Queue2 -> switch to Class3\nRT.set(jobclass4, jobclass4, node1, node3, 1.0)  # Delay -> Queue2\nRT.set(jobclass4, jobclass3, node3, node1, 1.0)  # Queue2 -> Delay (switch to Class3)\n\nmodel.link(RT)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.367631Z",
          "start_time": "2025-07-29T11:13:53.350110Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.545616Z",
          "iopub.execute_input": "2026-01-01T10:32:16.545689Z",
          "shell.execute_reply": "2026-01-01T10:32:16.547447Z",
          "iopub.status.idle": "2026-01-01T10:32:16.547645Z"
        }
      },
      "outputs": [],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Set initial state: all jobs at Queue2\nn = np.array([[0,0,0,0],        # Delay: no jobs\n              [0,0,0,0],        # Queue1: no jobs\n              [N[0],N[1],N[2],N[3]]])  # Queue2: all jobs\n\nnodes = [node1, node2, node3]\nfor i in range(len(nodes)):\n    nodes[i].set_state(n[i])",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.444903Z",
          "start_time": "2025-07-29T11:13:53.398168Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.548280Z",
          "iopub.execute_input": "2026-01-01T10:32:16.548348Z",
          "shell.execute_reply": "2026-01-01T10:32:16.549612Z",
          "iopub.status.idle": "2026-01-01T10:32:16.549822Z"
        }
      },
      "outputs": [],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "code",
      "source": "# Solver options\noptions = Solver.defaultOptions\noptions.verbose = 1",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.461786Z",
          "start_time": "2025-07-29T11:13:53.460125Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.550334Z",
          "iopub.execute_input": "2026-01-01T10:32:16.550401Z",
          "shell.execute_reply": "2026-01-01T10:32:16.551365Z",
          "iopub.status.idle": "2026-01-01T10:32:16.551516Z"
        }
      },
      "outputs": [],
      "execution_count": 7
    },
    "cell_7": {
      "cell_type": "code",
      "source": "# Solve with CTMC\nsolver_ctmc = CTMC(model, options)\nPr_ctmc = solver_ctmc.prob_sys_aggr()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:53.864507Z",
          "start_time": "2025-07-29T11:13:53.518779Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.551993Z",
          "iopub.execute_input": "2026-01-01T10:32:16.552058Z",
          "shell.execute_reply": "2026-01-01T10:32:16.596465Z",
          "iopub.status.idle": "2026-01-01T10:32:16.596709Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "/home/gcasale/Dropbox/code/line-dev.git/python/line_solver/api_native/solvers/ctmc/handler.py:518: RuntimeWarning: invalid value encountered in scalar multiply\n  TN[ist, k] = UN[ist, k] * c * mu\n",
            "numerical_values": [
              518.0
            ]
          }
        }
      ],
      "execution_count": 8
    },
    "cell_8": {
      "cell_type": "code",
      "source": "# Solve with NC (exact method)\noptions_nc = Solver.defaultOptions\noptions_nc.verbose = 1\noptions_nc.method = 'exact'\n\nsolver_nc = NC(model, options_nc)\nPr_nc = solver_nc.prob_sys_aggr()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:54.087253Z",
          "start_time": "2025-07-29T11:13:53.873519Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.597527Z",
          "iopub.execute_input": "2026-01-01T10:32:16.597611Z",
          "iopub.status.idle": "2026-01-01T10:32:16.599844Z",
          "shell.execute_reply": "2026-01-01T10:32:16.599626Z"
        }
      },
      "outputs": [],
      "execution_count": 9
    },
    "cell_9": {
      "cell_type": "code",
      "source": "# Solve with JMT (simulation)\nsolver_jmt = JMT(model, samples=10000, seed=532733)\nPr_jmt = solver_jmt.prob_sys_aggr()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:13:54.138248Z",
          "start_time": "2025-07-29T11:13:54.094926Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:32:16.600590Z",
          "iopub.execute_input": "2026-01-01T10:32:16.600678Z",
          "iopub.status.idle": "2026-01-01T10:32:16.903527Z",
          "shell.execute_reply": "2026-01-01T10:32:16.903241Z"
        }
      },
      "outputs": [],
      "execution_count": 10
    }
  },
  "numerical_summary": {
    "cell_1": [
      1.0,
      1.0,
      2.0,
      1.0,
      3.0,
      2.0,
      3.0,
      2.0,
      2.0,
      2.0
    ],
    "cell_6": [
      1.0
    ],
    "cell_7": [
      518.0
    ],
    "cell_8": [
      1.0
    ],
    "cell_9": [
      10000.0,
      532733.0
    ]
  },
  "metadata": {
    "notebook_path": "stateProbabilities/statepr_sys_aggr.ipynb",
    "source_dir": "examples/advanced",
    "total_cells": 10,
    "code_cells": 10,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}