{
  "cell_content": {
    "cell_0": {
      "cell_type": "markdown",
      "source": "# Advanced Example: Random Environment Closed Queueing Network\n\nThis example demonstrates a closed queueing network that can be used in random environment models:\n- **Nodes**: Delay node + PS Queue\n- **Class**: Single closed class with N jobs\n- **Service**: Parameterized exponential service rates\n\nThe model creates a simple 2-station closed network with circular routing.",
      "metadata": {},
      "outputs": [],
      "execution_count": null
    },
    "cell_1": {
      "cell_type": "code",
      "source": "from line_solver import *\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-01T10:31:55.824186Z",
          "iopub.execute_input": "2026-01-01T10:31:55.824277Z",
          "shell.execute_reply": "2026-01-01T10:31:56.307343Z",
          "iopub.status.idle": "2026-01-01T10:31:56.307633Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_2": {
      "cell_type": "code",
      "source": "def renv_genqn(rate, N):\n    \"\"\"\n    Create a simple closed queueing network for random environment models.\n    \n    Args:\n        rate: List of service rates [rate1, rate2] for the two stations\n        N: Population size (number of jobs in the closed network)\n    \n    Returns:\n        Network: A closed queueing network model\n    \"\"\"\n    model = Network('qn1')\n    \n    # Block 1: nodes\n    delay = Delay(model, 'Queue1')\n    queue = Queue(model, 'Queue2', SchedStrategy.PS)\n    \n    # Block 2: classes\n    jobclass = ClosedClass(model, 'Class1', N, delay, 0)\n    \n    # Set service rates\n    delay.set_service(jobclass, Exp(rate[0]))\n    queue.set_service(jobclass, Exp(rate[1]))\n    \n    # Block 3: topology (circular routing)\n    P = model.init_routing_matrix()\n    P.add_route(jobclass, delay, queue, 1.0)\n    P.add_route(jobclass, queue, delay, 1.0)\n    model.link(P)\n    \n    return model\n\n# Create the model with example parameters\nmodel = renv_genqn(rate=[2.0, 3.0], N=5)",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-01T10:31:56.308731Z",
          "iopub.execute_input": "2026-01-01T10:31:56.308867Z",
          "shell.execute_reply": "2026-01-01T10:31:56.310808Z",
          "iopub.status.idle": "2026-01-01T10:31:56.311042Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_3": {
      "cell_type": "markdown",
      "source": "## About Random Environment Models\n\nRandom environment queueing models feature:\n- **Base network**: A queueing network (like this closed QN)\n- **Environment process**: A Markov chain that modulates network parameters\n- **State-dependent rates**: Service/arrival rates depend on environment state\n\nThis simple closed network is a building block for:\n- Markov-modulated queueing systems\n- Systems with random breakdowns\n- Networks with time-varying workloads",
      "metadata": {},
      "outputs": [],
      "execution_count": null
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Solve with multiple solvers\nprint(\"\\n=== Solver Results ===\")\n\n# MVA Solver\nsolver_mva = MVA(model)\navg_table_mva = solver_mva.avg_table()\nprint(\"\\nMVA Solver:\")\nprint(avg_table_mva)\n\n# CTMC Solver\nsolver_ctmc = CTMC(model)\navg_table_ctmc = solver_ctmc.avg_table()\nprint(\"\\nCTMC Solver:\")\nprint(avg_table_ctmc)\n\n# Fluid Solver\nsolver_fluid = FLD(model)\navg_table_fluid = solver_fluid.avg_table()\nprint(\"\\nFluid Solver:\")\nprint(avg_table_fluid)",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-01T10:31:56.311744Z",
          "iopub.execute_input": "2026-01-01T10:31:56.311822Z",
          "shell.execute_reply": "2026-01-01T10:31:56.363236Z",
          "iopub.status.idle": "2026-01-01T10:31:56.363610Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "\n=== Solver Results ===\n\nMVA Solver:\n  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0  Queue1   Class1  2.8460  0.9158  1.5539  1.5539  1.8315  1.8315\n1  Queue2   Class1  1.2383  0.6105  0.6761  0.6761  1.8315  1.8315\n\nCTMC Solver:\n  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0  Queue1   Class1  1.4787  0.0000  0.0000  0.0000  0.0000  0.0000\n1  Queue2   Class1  3.5213  0.9858  1.1906  1.1906  2.9575  2.9575\nStation JobClass  QLen  Util  RespT  ResidT  ArvR  Tput\n Queue1   Class1   1.5   1.5 0.5000  0.5000   3.0   3.0\n Queue2   Class1   3.5   1.0 1.1667  1.1667   3.0   3.0\n\nFluid Solver:\n  Station JobClass  QLen  Util   RespT  ResidT  ArvR  Tput\n0  Queue1   Class1   1.5   1.5  0.5000  0.5000   3.0   3.0\n1  Queue2   Class1   3.5   1.0  1.1667  1.1667   3.0   3.0\n",
            "numerical_values": [
              0.0,
              1.0,
              1.0,
              2.846,
              0.9158,
              1.5539,
              1.5539,
              1.8315,
              1.8315,
              1.0,
              2.0,
              1.0,
              1.2383,
              0.6105,
              0.6761,
              0.6761,
              1.8315,
              1.8315,
              0.0,
              1.0,
              1.0,
              1.4787,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              2.0,
              1.0,
              3.5213,
              0.9858,
              1.1906,
              1.1906,
              2.9575,
              2.9575,
              1.0,
              1.0,
              1.5,
              1.5,
              0.5,
              0.5,
              3.0,
              3.0,
              2.0,
              1.0,
              3.5,
              1.0,
              1.1667,
              1.1667,
              3.0,
              3.0,
              0.0,
              1.0,
              1.0,
              1.5,
              1.5,
              0.5,
              0.5,
              3.0,
              3.0,
              1.0,
              2.0,
              1.0,
              3.5,
              1.0,
              1.1667,
              1.1667,
              3.0,
              3.0
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "/home/gcasale/Dropbox/code/line-dev.git/python/line_solver/solvers_native/solver_mva.py:378: RuntimeWarning: invalid value encountered in cast\n  result = pfqn_mvams(lambda_arr, L, N, Z, mi=None, S=mi.astype(int))\n/home/gcasale/Dropbox/code/line-dev.git/python/line_solver/api_native/solvers/ctmc/handler.py:518: RuntimeWarning: invalid value encountered in scalar multiply\n  TN[ist, k] = UN[ist, k] * c * mu\n",
            "numerical_values": [
              378.0,
              518.0
            ]
          }
        }
      ],
      "execution_count": 3
    }
  },
  "numerical_summary": {
    "cell_0": [
      2.0
    ],
    "cell_4": [
      0.0,
      1.0,
      1.0,
      2.846,
      0.9158,
      1.5539,
      1.5539,
      1.8315,
      1.8315,
      1.0,
      2.0,
      1.0,
      1.2383,
      0.6105,
      0.6761,
      0.6761,
      1.8315,
      1.8315,
      0.0,
      1.0,
      1.0,
      1.4787,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      2.0,
      1.0,
      3.5213,
      0.9858,
      1.1906,
      1.1906,
      2.9575,
      2.9575,
      1.0,
      1.0,
      1.5,
      1.5,
      0.5,
      0.5,
      3.0,
      3.0,
      2.0,
      1.0,
      3.5,
      1.0,
      1.1667,
      1.1667,
      3.0,
      3.0,
      0.0,
      1.0,
      1.0,
      1.5,
      1.5,
      0.5,
      0.5,
      3.0,
      3.0,
      1.0,
      2.0,
      1.0,
      3.5,
      1.0,
      1.1667,
      1.1667,
      3.0,
      3.0,
      378.0,
      518.0
    ]
  },
  "metadata": {
    "notebook_path": "randomEnv/renv_genqn.ipynb",
    "source_dir": "examples/advanced",
    "total_cells": 5,
    "code_cells": 3,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}