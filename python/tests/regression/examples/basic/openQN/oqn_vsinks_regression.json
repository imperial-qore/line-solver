{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:47.864235Z",
          "start_time": "2025-07-30T22:22:46.718128Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:57.904081Z",
          "iopub.execute_input": "2026-01-01T10:30:57.904168Z",
          "iopub.status.idle": "2026-01-01T10:30:58.352668Z",
          "shell.execute_reply": "2026-01-01T10:30:58.352320Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "# Create the model\nmodel = Network('model')",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:47.931137Z",
          "start_time": "2025-07-30T22:22:47.925391Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.353881Z",
          "iopub.execute_input": "2026-01-01T10:30:58.354014Z",
          "shell.execute_reply": "2026-01-01T10:30:58.355240Z",
          "iopub.status.idle": "2026-01-01T10:30:58.355452Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "# Define network nodes\nsource = Source(model, 'Source')\nqueue = Queue(model, 'Queue1', SchedStrategy.FCFS)\nsink = Sink(model, 'Sink')\nvsink1 = Router(model, 'VSink1')  # Virtual sink 1\nvsink2 = Router(model, 'VSink2')  # Virtual sink 2",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.004186Z",
          "start_time": "2025-07-30T22:22:47.991906Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.356134Z",
          "iopub.execute_input": "2026-01-01T10:30:58.356220Z",
          "shell.execute_reply": "2026-01-01T10:30:58.357610Z",
          "iopub.status.idle": "2026-01-01T10:30:58.357814Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "# Define job classes\nocl1 = OpenClass(model, 'Class1')\nocl2 = OpenClass(model, 'Class2')",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.045826Z",
          "start_time": "2025-07-30T22:22:48.040807Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.358478Z",
          "iopub.execute_input": "2026-01-01T10:30:58.358552Z",
          "shell.execute_reply": "2026-01-01T10:30:58.359734Z",
          "iopub.status.idle": "2026-01-01T10:30:58.359935Z"
        }
      },
      "outputs": [],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Set arrival processes\nsource.set_arrival(ocl1, Exp(1.0))  # Class1: arrival rate 1.0\nsource.set_arrival(ocl2, Exp(1.0))  # Class2: arrival rate 1.0",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.095933Z",
          "start_time": "2025-07-30T22:22:48.090415Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.360604Z",
          "iopub.execute_input": "2026-01-01T10:30:58.360688Z",
          "iopub.status.idle": "2026-01-01T10:30:58.361986Z",
          "shell.execute_reply": "2026-01-01T10:30:58.361777Z"
        }
      },
      "outputs": [],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Set service processes\nqueue.set_service(ocl1, Exp(100.0))  # Class1: very fast service (rate 100)\nqueue.set_service(ocl2, Exp(100.0))  # Class2: very fast service (rate 100)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.146080Z",
          "start_time": "2025-07-30T22:22:48.141985Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.362614Z",
          "iopub.execute_input": "2026-01-01T10:30:58.362705Z",
          "shell.execute_reply": "2026-01-01T10:30:58.363810Z",
          "iopub.status.idle": "2026-01-01T10:30:58.363988Z"
        }
      },
      "outputs": [],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "code",
      "source": "# Configure routing matrix with virtual sinks\nP = model.init_routing_matrix()\n\n# Class1 routing\nP.set(ocl1, ocl1, source, queue, 1.0)     # Source \u2192 Queue1\nP.set(ocl1, ocl1, queue, vsink1, 0.6)     # Queue1 \u2192 VSink1 (60%)\nP.set(ocl1, ocl1, queue, vsink2, 0.4)     # Queue1 \u2192 VSink2 (40%)\nP.set(ocl1, ocl1, vsink1, sink, 1.0)      # VSink1 \u2192 Sink\nP.set(ocl1, ocl1, vsink2, sink, 1.0)      # VSink2 \u2192 Sink\n\n# Class2 routing\nP.set(ocl2, ocl2, source, queue, 1.0)     # Source \u2192 Queue1\nP.set(ocl2, ocl2, queue, vsink1, 0.1)     # Queue1 \u2192 VSink1 (10%)\nP.set(ocl2, ocl2, queue, vsink2, 0.9)     # Queue1 \u2192 VSink2 (90%)\nP.set(ocl2, ocl2, vsink1, sink, 1.0)      # VSink1 \u2192 Sink\nP.set(ocl2, ocl2, vsink2, sink, 1.0)      # VSink2 \u2192 Sink\n\nmodel.link(P)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.199404Z",
          "start_time": "2025-07-30T22:22:48.189592Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.364585Z",
          "iopub.execute_input": "2026-01-01T10:30:58.364662Z",
          "shell.execute_reply": "2026-01-01T10:30:58.366243Z",
          "iopub.status.idle": "2026-01-01T10:30:58.366407Z"
        }
      },
      "outputs": [],
      "execution_count": 7
    },
    "cell_7": {
      "cell_type": "code",
      "source": "# Expected throughput calculations\n# Input rates\nclass1_arrival = 1.0\nclass2_arrival = 1.0\n\n# Class1 flows\nclass1_to_vsink1 = class1_arrival * 0.6\nclass1_to_vsink2 = class1_arrival * 0.4\n\n# Class2 flows\nclass2_to_vsink1 = class2_arrival * 0.1\nclass2_to_vsink2 = class2_arrival * 0.9\n\n# Total flows to each virtual sink\ntotal_to_vsink1 = class1_to_vsink1 + class2_to_vsink1\ntotal_to_vsink2 = class1_to_vsink2 + class2_to_vsink2\n\nprint(f\"Class1 flows:\")\nprint(f\"  To VSink1: {class1_to_vsink1:.1f}\")\nprint(f\"  To VSink2: {class1_to_vsink2:.1f}\")\n\nprint(f\"\\nClass2 flows:\")\nprint(f\"  To VSink1: {class2_to_vsink1:.1f}\")\nprint(f\"  To VSink2: {class2_to_vsink2:.1f}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.242299Z",
          "start_time": "2025-07-30T22:22:48.239906Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.366942Z",
          "iopub.execute_input": "2026-01-01T10:30:58.367014Z",
          "iopub.status.idle": "2026-01-01T10:30:58.368992Z",
          "shell.execute_reply": "2026-01-01T10:30:58.368754Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Class1 flows:\n  To VSink1: 0.6\n  To VSink2: 0.4\n\nClass2 flows:\n  To VSink1: 0.1\n  To VSink2: 0.9\n",
            "numerical_values": [
              1.0,
              1.0,
              0.6,
              2.0,
              0.4,
              2.0,
              1.0,
              0.1,
              2.0,
              0.9
            ]
          }
        }
      ],
      "execution_count": 8
    },
    "cell_8": {
      "cell_type": "code",
      "source": "# Aligned with JAR test scenarios for oqn_vsinks\n# JAR tests: MVA(), MAM(), NC()\n\n# Solve with MVA solver (matches JAR)\nsolver_mva = MVA(model)\nAvgTable = solver_mva.avg_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.418895Z",
          "start_time": "2025-07-30T22:22:48.290110Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.369675Z",
          "iopub.execute_input": "2026-01-01T10:30:58.369791Z",
          "iopub.status.idle": "2026-01-01T10:30:58.412283Z",
          "shell.execute_reply": "2026-01-01T10:30:58.411889Z"
        }
      },
      "outputs": [],
      "execution_count": 9
    },
    "cell_9": {
      "cell_type": "code",
      "source": "AvgNodeTable = solver_mva.avg_node_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.436307Z",
          "start_time": "2025-07-30T22:22:48.428256Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.413546Z",
          "iopub.execute_input": "2026-01-01T10:30:58.413651Z",
          "shell.execute_reply": "2026-01-01T10:30:58.415959Z",
          "iopub.status.idle": "2026-01-01T10:30:58.416158Z"
        }
      },
      "outputs": [],
      "execution_count": 10
    },
    "cell_10": {
      "cell_type": "code",
      "source": "# Solve with MAM solver for comparison (matches JAR)\nsolver_mam = MAM(model)\nAvgTableMAM = solver_mam.avg_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.560336Z",
          "start_time": "2025-07-30T22:22:48.491300Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.417044Z",
          "iopub.execute_input": "2026-01-01T10:30:58.417130Z",
          "shell.execute_reply": "2026-01-01T10:30:58.420276Z",
          "iopub.status.idle": "2026-01-01T10:30:58.420491Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Station JobClass   QLen  Util  RespT  ResidT  ArvR  Tput\n Source   Class1 0.0000  0.00 0.0000  0.0000   0.0   1.0\n Source   Class2 0.0000  0.00 0.0000  0.0000   0.0   1.0\n Queue1   Class1 0.0101  0.01 0.0101  0.0101   1.0   1.0\n Queue1   Class2 0.0101  0.01 0.0101  0.0101   1.0   1.0\n",
            "numerical_values": [
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              2.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              1.0,
              1.0,
              0.0101,
              0.01,
              0.0101,
              0.0101,
              1.0,
              1.0,
              1.0,
              2.0,
              0.0101,
              0.01,
              0.0101,
              0.0101,
              1.0,
              1.0
            ]
          }
        }
      ],
      "execution_count": 11
    },
    "cell_11": {
      "cell_type": "code",
      "source": "AvgNodeTableMAM = solver_mam.avg_node_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.583056Z",
          "start_time": "2025-07-30T22:22:48.578507Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.421244Z",
          "iopub.execute_input": "2026-01-01T10:30:58.421326Z",
          "shell.execute_reply": "2026-01-01T10:30:58.423657Z",
          "iopub.status.idle": "2026-01-01T10:30:58.423892Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Station JobClass   QLen  Util  RespT  ResidT  ArvR  Tput\n Source   Class1 0.0000  0.00 0.0000  0.0000   0.0   1.0\n Source   Class2 0.0000  0.00 0.0000  0.0000   0.0   1.0\n Queue1   Class1 0.0101  0.01 0.0101  0.0101   1.0   1.0\n Queue1   Class2 0.0101  0.01 0.0101  0.0101   1.0   1.0\n",
            "numerical_values": [
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              2.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              1.0,
              1.0,
              0.0101,
              0.01,
              0.0101,
              0.0101,
              1.0,
              1.0,
              1.0,
              2.0,
              0.0101,
              0.01,
              0.0101,
              0.0101,
              1.0,
              1.0
            ]
          }
        }
      ],
      "execution_count": 12
    },
    "cell_12": {
      "cell_type": "code",
      "source": "# Solve with NC solver for comparison (matches JAR)\nsolver_nc = NC(model)\nAvgTableNC = solver_nc.avg_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.674899Z",
          "start_time": "2025-07-30T22:22:48.639446Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.424538Z",
          "iopub.execute_input": "2026-01-01T10:30:58.424617Z",
          "shell.execute_reply": "2026-01-01T10:30:58.427137Z",
          "iopub.status.idle": "2026-01-01T10:30:58.427317Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "/home/gcasale/Dropbox/code/line-dev.git/python/line_solver/api_native/pfqn/nc.py:125: RuntimeWarning: invalid value encountered in cast\n  N = np.ceil(N).astype(int)\n",
            "numerical_values": [
              125.0
            ]
          }
        }
      ],
      "execution_count": 13
    },
    "cell_13": {
      "cell_type": "code",
      "source": "AvgNodeTableNC = solver_nc.avg_node_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:22:48.713402Z",
          "start_time": "2025-07-30T22:22:48.708857Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-01T10:30:58.427947Z",
          "iopub.execute_input": "2026-01-01T10:30:58.428025Z",
          "shell.execute_reply": "2026-01-01T10:30:58.429749Z",
          "iopub.status.idle": "2026-01-01T10:30:58.429953Z"
        }
      },
      "outputs": [],
      "execution_count": 14
    }
  },
  "numerical_summary": {
    "cell_2": [
      1.0,
      1.0,
      1.0,
      1.0,
      2.0,
      2.0,
      2.0
    ],
    "cell_3": [
      1.0,
      1.0,
      2.0,
      2.0
    ],
    "cell_4": [
      1.0,
      1.0,
      1.0,
      1.0,
      2.0,
      1.0,
      2.0,
      1.0
    ],
    "cell_5": [
      1.0,
      100.0,
      1.0,
      100.0,
      2.0,
      100.0,
      2.0,
      100.0
    ],
    "cell_7": [
      1.0,
      1.0,
      0.6,
      2.0,
      0.4,
      2.0,
      1.0,
      0.1,
      2.0,
      0.9
    ],
    "cell_10": [
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      2.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      1.0,
      1.0,
      0.0101,
      0.01,
      0.0101,
      0.0101,
      1.0,
      1.0,
      1.0,
      2.0,
      0.0101,
      0.01,
      0.0101,
      0.0101,
      1.0,
      1.0
    ],
    "cell_11": [
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      2.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      1.0,
      1.0,
      0.0101,
      0.01,
      0.0101,
      0.0101,
      1.0,
      1.0,
      1.0,
      2.0,
      0.0101,
      0.01,
      0.0101,
      0.0101,
      1.0,
      1.0
    ],
    "cell_12": [
      125.0
    ]
  },
  "metadata": {
    "notebook_path": "openQN/oqn_vsinks.ipynb",
    "source_dir": "examples/basic",
    "total_cells": 14,
    "code_cells": 14,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}