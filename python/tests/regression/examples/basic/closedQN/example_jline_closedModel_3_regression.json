{
  "cell_content": {
    "cell_0": {
      "cell_type": "markdown",
      "source": "# Basic Example: Multiclass Closed QN with Class Switching\n\nThis example demonstrates a complex closed queueing network:\n- **Nodes**: Delay node + PS Queue\n- **Classes**: 3 job classes with different service distributions\n- **Routing**: Complex class switching patterns between stations\n\nThe model showcases various distribution types and class switching.",
      "metadata": {},
      "outputs": [],
      "execution_count": null
    },
    "cell_1": {
      "cell_type": "code",
      "source": "from line_solver import *\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-01T10:26:26.820404Z",
          "iopub.execute_input": "2026-01-01T10:26:26.820492Z",
          "shell.execute_reply": "2026-01-01T10:26:27.271582Z",
          "iopub.status.idle": "2026-01-01T10:26:27.271919Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_2": {
      "cell_type": "code",
      "source": "def example_jline_closedModel_3():\n    \"\"\"\n    Create a multiclass closed QN with class switching.\n    \n    Features:\n    - Delay node with Erlang, HyperExp, and Exp service\n    - PS Queue with HyperExp and Exp service\n    - Complex class switching routing\n    \"\"\"\n    model = Network('model')\n    \n    # Block 1: nodes\n    delay = Delay(model, 'Delay')\n    queue = Queue(model, 'Queue1', SchedStrategy.PS)\n    \n    # Block 2: classes\n    jobclass1 = ClosedClass(model, 'Class1', 2, delay, 0)\n    jobclass2 = ClosedClass(model, 'Class2', 0, delay, 0)\n    jobclass3 = ClosedClass(model, 'Class3', 1, delay, 0)\n    \n    # Service times at Delay node\n    delay.set_service(jobclass1, Erlang(3, 2))\n    delay.set_service(jobclass2, HyperExp(0.5, 3.0, 10.0))\n    delay.set_service(jobclass3, Exp(1))\n    \n    # Service times at Queue\n    queue.set_service(jobclass1, HyperExp(0.1, 1.0, 10.0))\n    queue.set_service(jobclass2, Exp(2))\n    queue.set_service(jobclass3, Exp(3))\n    \n    # Block 3: topology with class switching\n    # This creates a complex routing pattern between classes\n    P = model.init_routing_matrix()\n    \n    # Class 1 routing\n    P.add_route(jobclass1, delay, delay, 0.3)\n    P.add_route(jobclass1, delay, queue, 0.6)\n    P.add_class_switch(jobclass1, jobclass2, delay, delay, 0.1)\n    P.add_route(jobclass1, queue, delay, 0.2)\n    P.add_class_switch(jobclass1, jobclass2, queue, queue, 0.8)\n    \n    # Class 2 routing  \n    P.add_class_switch(jobclass2, jobclass1, delay, queue, 1.0)\n    P.add_class_switch(jobclass2, jobclass1, queue, delay, 1.0)\n    \n    # Class 3 routing (simple circular)\n    P.add_route(jobclass3, delay, queue, 1.0)\n    P.add_route(jobclass3, queue, delay, 1.0)\n    \n    model.link(P)\n    \n    return model\n\n# Create the model\nmodel = example_jline_closedModel_3()",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-01T10:26:27.273082Z",
          "iopub.execute_input": "2026-01-01T10:26:27.273262Z",
          "shell.execute_reply": "2026-01-01T10:26:27.276157Z",
          "iopub.status.idle": "2026-01-01T10:26:27.276463Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_3": {
      "cell_type": "markdown",
      "source": "## About This Model\n\n**Service distributions**:\n- **Erlang(3, 2)**: 2-phase Erlang with rate 3\n- **HyperExp(0.5, 3.0, 10.0)**: Mixture with p=0.5, rates 3.0 and 10.0\n- **Exp(\u03bc)**: Exponential with rate \u03bc\n\n**Class switching**:\n- Class 1 jobs can become Class 2 jobs\n- Class 2 jobs become Class 1 jobs\n- Class 3 jobs circulate independently\n\nThis creates complex interactions between classes.",
      "metadata": {},
      "outputs": [],
      "execution_count": null
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Solve with MVA\nprint(\"\\n=== Solver Results ===\")\n\n# MVA Solver\nsolver_mva = MVA(model)\nprint(f\"\\nSOLVER: {solver_mva.name}\")\navg_table = solver_mva.avg_table()\nprint(avg_table)",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-01T10:26:27.277343Z",
          "iopub.execute_input": "2026-01-01T10:26:27.277462Z",
          "iopub.status.idle": "2026-01-01T10:26:27.324722Z",
          "shell.execute_reply": "2026-01-01T10:26:27.324409Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "\n=== Solver Results ===\n\nSOLVER: MVA\n  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0   Delay   Class1  1.3229  0.6311  6.2885  6.2885  0.2104  0.2104\n1   Delay   Class3  0.6158  0.2845  2.1645  2.1645  0.2845  0.2845\n2  Queue1   Class1  0.0460  0.0400  0.2186  0.2186  0.2104  0.2104\n3  Queue1   Class3  0.0997  0.0948  0.3504  0.3504  0.2845  0.2845\n",
            "numerical_values": [
              0.0,
              1.0,
              1.3229,
              0.6311,
              6.2885,
              6.2885,
              0.2104,
              0.2104,
              1.0,
              3.0,
              0.6158,
              0.2845,
              2.1645,
              2.1645,
              0.2845,
              0.2845,
              2.0,
              1.0,
              1.0,
              0.046,
              0.04,
              0.2186,
              0.2186,
              0.2104,
              0.2104,
              3.0,
              1.0,
              3.0,
              0.0997,
              0.0948,
              0.3504,
              0.3504,
              0.2845,
              0.2845
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "/home/gcasale/Dropbox/code/line-dev.git/python/line_solver/solvers_native/solver_mva.py:378: RuntimeWarning: invalid value encountered in cast\n  result = pfqn_mvams(lambda_arr, L, N, Z, mi=None, S=mi.astype(int))\n",
            "numerical_values": [
              378.0
            ]
          }
        }
      ],
      "execution_count": 3
    }
  },
  "numerical_summary": {
    "cell_0": [
      3.0
    ],
    "cell_4": [
      0.0,
      1.0,
      1.3229,
      0.6311,
      6.2885,
      6.2885,
      0.2104,
      0.2104,
      1.0,
      3.0,
      0.6158,
      0.2845,
      2.1645,
      2.1645,
      0.2845,
      0.2845,
      2.0,
      1.0,
      1.0,
      0.046,
      0.04,
      0.2186,
      0.2186,
      0.2104,
      0.2104,
      3.0,
      1.0,
      3.0,
      0.0997,
      0.0948,
      0.3504,
      0.3504,
      0.2845,
      0.2845,
      378.0
    ]
  },
  "metadata": {
    "notebook_path": "closedQN/example_jline_closedModel_3.ipynb",
    "source_dir": "examples/basic",
    "total_cells": 5,
    "code_cells": 3,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}