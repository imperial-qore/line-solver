{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:43.024001Z",
          "start_time": "2025-07-30T22:15:43.021338Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.030597Z",
          "iopub.execute_input": "2026-01-03T15:31:38.030769Z",
          "shell.execute_reply": "2026-01-03T15:31:38.767001Z",
          "iopub.status.idle": "2026-01-03T15:31:38.767553Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "# Create network\nmodel = Network('model')\n\n# Block 1: nodes\nnode = np.empty(3, dtype=object)\nnode[0] = Delay(model, 'Delay')\nnode[1] = Queue(model, 'Queue1', SchedStrategy.PS)\nnode[2] = Queue(model, 'Queue2', SchedStrategy.PS)\n\n# Block 2: classes (1 job each)\njobclass = np.empty(2, dtype=object)\njobclass[0] = ClosedClass(model, 'Class1', 1, node[0], 0)\njobclass[1] = ClosedClass(model, 'Class2', 1, node[0], 0)\n\nprint(\"Network created with 3 nodes and 2 classes (1 job each)\")\nprint(f\"  {node[0].get_name()}: Delay node\")\nprint(f\"  {node[1].get_name()}: PS Queue\")\nprint(f\"  {node[2].get_name()}: PS Queue\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:43.042629Z",
          "start_time": "2025-07-30T22:15:43.039512Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.769258Z",
          "iopub.execute_input": "2026-01-03T15:31:38.769582Z",
          "iopub.status.idle": "2026-01-03T15:31:38.772799Z",
          "shell.execute_reply": "2026-01-03T15:31:38.772489Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Network created with 3 nodes and 2 classes (1 job each)\n  Delay: Delay node\n  Queue1: PS Queue\n  Queue2: PS Queue\n",
            "numerical_values": [
              3.0,
              2.0,
              1.0,
              1.0,
              2.0
            ]
          }
        }
      ],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "# Set advanced service distributions\n# Delay node - mixed distributions\nnode[0].set_service(jobclass[0], Erlang.fit_mean_and_order(3, 2))  # Erlang with mean=3, shape=2\nnode[0].set_service(jobclass[1], HyperExp(0.5, 3.0, 10.0))     # HyperExp with prob=0.5, rates=3.0,10.0\nprint(\"Delay node distributions:\")\nprint(\"  Class1: Erlang(mean=3, shape=2) - Low variability\")\nprint(\"  Class2: HyperExp(p=0.5, \u03bb1=3, \u03bb2=10) - High variability\")\n\n# Queue1 - HyperExp and MMPP2\nnode[1].set_service(jobclass[0], HyperExp(0.1, 1.0, 10.0))     # HyperExp with prob=0.1, rates=1.0,10.0\nnode[1].set_service(jobclass[1], MMPP2(1, 2, 3, 4))           # MMPP2 with parameters \u03bb0=1, \u03bb1=2, \u03c301=3, \u03c310=4\nprint(\"\\nQueue1 distributions:\")\nprint(\"  Class1: HyperExp(p=0.1, \u03bb1=1, \u03bb2=10) - Very high variability\")\nprint(\"  Class2: MMPP2(\u03bb0=1, \u03bb1=2, \u03c301=3, \u03c310=4) - Markov Modulated Poisson Process\")\n\n# Queue2 - HyperExp and Erlang\nnode[2].set_service(jobclass[0], HyperExp(0.1, 1.0, 10.0))     # Same as Queue1 for Class1\nnode[2].set_service(jobclass[1], Erlang(1, 2))                 # Erlang with rate=1, shape=2\nprint(\"\\nQueue2 distributions:\")\nprint(\"  Class1: HyperExp(p=0.1, \u03bb1=1, \u03bb2=10) - Same as Queue1\")\nprint(\"  Class2: Erlang(rate=1, shape=2) - Low variability\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:43.102356Z",
          "start_time": "2025-07-30T22:15:43.098998Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.786134Z",
          "iopub.execute_input": "2026-01-03T15:31:38.786425Z",
          "shell.execute_reply": "2026-01-03T15:31:38.790628Z",
          "iopub.status.idle": "2026-01-03T15:31:38.791084Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Delay node distributions:\n  Class1: Erlang(mean=3, shape=2) - Low variability\n  Class2: HyperExp(p=0.5, \u03bb1=3, \u03bb2=10) - High variability\n\nQueue1 distributions:\n  Class1: HyperExp(p=0.1, \u03bb1=1, \u03bb2=10) - Very high variability\n  Class2: MMPP2(\u03bb0=1, \u03bb1=2, \u03c301=3, \u03c310=4) - Markov Modulated Poisson Process\n\nQueue2 distributions:\n  Class1: HyperExp(p=0.1, \u03bb1=1, \u03bb2=10) - Same as Queue1\n  Class2: Erlang(rate=1, shape=2) - Low variability\n",
            "numerical_values": [
              1.0,
              3.0,
              2.0,
              2.0,
              0.5,
              1.0,
              3.0,
              2.0,
              10.0,
              1.0,
              1.0,
              0.1,
              1.0,
              1.0,
              2.0,
              10.0,
              2.0,
              2.0,
              0.0,
              1.0,
              1.0,
              2.0,
              1.0,
              3.0,
              10.0,
              4.0,
              2.0,
              1.0,
              0.1,
              1.0,
              1.0,
              2.0,
              10.0,
              1.0,
              2.0,
              1.0,
              2.0
            ]
          }
        }
      ],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "# Set up connectivity\nmodel.add_link(node[0], node[0])  # Delay can route to itself\nmodel.add_link(node[0], node[1])  # Delay -> Queue1\nmodel.add_link(node[0], node[2])  # Delay -> Queue2\nmodel.add_link(node[1], node[0])  # Queue1 -> Delay\nmodel.add_link(node[2], node[0])  # Queue2 -> Delay\n\nprint(\"\\n=== Configuring Routing Strategies ===\")\n\n# Class1: Probabilistic routing from Delay\nnode[0].set_prob_routing(jobclass[0], node[0], 0.0)  # No self-loop for Class1\nnode[0].set_prob_routing(jobclass[0], node[1], 0.3)  # 30% to Queue1\nnode[0].set_prob_routing(jobclass[0], node[2], 0.7)  # 70% to Queue2\nnode[1].set_prob_routing(jobclass[0], node[0], 1.0)  # Queue1 -> Delay (deterministic)\nnode[2].set_prob_routing(jobclass[0], node[0], 1.0)  # Queue2 -> Delay (deterministic)\n\nprint(\"Class1 routing (Probabilistic):\")\nprint(\"  From Delay: 30% Queue1, 70% Queue2\")\nprint(\"  From Queues: 100% back to Delay\")\n\n# Class2: Random routing strategy\nnode[0].set_routing(jobclass[1], RoutingStrategy.RAND)  # Random from Delay\nnode[1].set_routing(jobclass[1], RoutingStrategy.RAND)  # Random from Queue1\nnode[2].set_routing(jobclass[1], RoutingStrategy.RAND)  # Random from Queue2\n\nprint(\"\\nClass2 routing (Random):\")\nprint(\"  All nodes use random routing among connected destinations\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:43.164528Z",
          "start_time": "2025-07-30T22:15:43.161093Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.792232Z",
          "iopub.execute_input": "2026-01-03T15:31:38.792362Z",
          "shell.execute_reply": "2026-01-03T15:31:38.795823Z",
          "iopub.status.idle": "2026-01-03T15:31:38.796193Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "\n=== Configuring Routing Strategies ===\nClass1 routing (Probabilistic):\n  From Delay: 30% Queue1, 70% Queue2\n  From Queues: 100% back to Delay\n\nClass2 routing (Random):\n  All nodes use random routing among connected destinations\n",
            "numerical_values": [
              1.0,
              30.0,
              1.0,
              70.0,
              2.0,
              100.0,
              2.0
            ]
          }
        }
      ],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Link the routing matrix\nP = model.init_routing_matrix()\nmodel.link(P)\n\nprint(\"Routing matrix linked successfully\")\nprint(\"\\nModel configuration complete!\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:43.220738Z",
          "start_time": "2025-07-30T22:15:43.218349Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.797267Z",
          "iopub.execute_input": "2026-01-03T15:31:38.797368Z",
          "shell.execute_reply": "2026-01-03T15:31:38.799395Z",
          "iopub.status.idle": "2026-01-03T15:31:38.799998Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Routing matrix linked successfully\n\nModel configuration complete!\n"
          }
        }
      ],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Aligned with JAR test scenarios for cqn_mmpp2_service\n# JAR tests: JMT(seed=23000), DES(seed=23000)\n\n# Configure solvers\nsolver = np.array([], dtype=object)\n\n# JMT with seed=23000 (matches JAR)\nsolver = np.append(solver, JMT(model, seed=23000))\n\n# DES with seed=23000 (matches MATLAB)\nsolver = np.append(solver, DES(model, seed=23000))\n\nprint(\"Solvers configured with seed=23000 (matches JAR)\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:43.293500Z",
          "start_time": "2025-07-30T22:15:43.287322Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.803365Z",
          "iopub.execute_input": "2026-01-03T15:31:38.803465Z",
          "shell.execute_reply": "2026-01-03T15:31:38.807979Z",
          "iopub.status.idle": "2026-01-03T15:31:38.808340Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Solvers configured with seed=23000 (matches JAR)\n",
            "numerical_values": [
              23000.0
            ]
          }
        }
      ],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "code",
      "source": "# Solve with each solver\nfor s in range(len(solver)):\n    print(f'\\n=== SOLVER: {solver[s].get_name()} ===')\n    avg_table = solver[s].avg_table()\n    print(avg_table)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:15:44.374832Z",
          "start_time": "2025-07-30T22:15:43.358487Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:38.809522Z",
          "iopub.execute_input": "2026-01-03T15:31:38.809628Z",
          "shell.execute_reply": "2026-01-03T15:31:39.534649Z",
          "iopub.status.idle": "2026-01-03T15:31:39.535095Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "\n=== SOLVER: JMT ===\n"
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Station JobClass  QLen  Util  RespT  ResidT  ArvR  Tput\n  Delay   Class1   0.0   0.0    0.0     0.0   0.0   0.0\n  Delay   Class2   0.0   1.0    0.0     0.0   0.0   0.0\n Queue1   Class1   0.0   0.0    0.0     0.0   0.0   0.0\n Queue1   Class2   0.0   0.0    0.0     0.0   0.0   0.0\n Queue2   Class1   0.0   0.0    0.0     0.0   0.0   0.0\n Queue2   Class2   0.0   0.0    0.0     0.0   0.0   0.0\n  Station JobClass  QLen  Util  RespT  ResidT  ArvR  Tput\n0   Delay   Class1   0.0   0.0    0.0     0.0   0.0   0.0\n1   Delay   Class2   0.0   1.0    0.0     0.0   0.0   0.0\n2  Queue1   Class1   0.0   0.0    0.0     0.0   0.0   0.0\n3  Queue1   Class2   0.0   0.0    0.0     0.0   0.0   0.0\n4  Queue2   Class1   0.0   0.0    0.0     0.0   0.0   0.0\n5  Queue2   Class2   0.0   0.0    0.0     0.0   0.0   0.0\n\n=== SOLVER: DES ===\nStation JobClass   QLen   Util  RespT  ResidT   ArvR   Tput\n  Delay   Class1 1.0000 1.0000 6.9525  6.9525 0.1438 0.1438\n  Delay   Class2 0.1209 0.1209 0.8404  0.8404 0.1438 0.1438\n  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0   Delay   Class1  1.0000  1.0000  6.9525  6.9525  0.1438  0.1438\n1   Delay   Class2  0.1209  0.1209  0.8404  0.8404  0.1438  0.1438\n",
            "numerical_values": [
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              2.0,
              0.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              2.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              2.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              2.0,
              2.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              2.0,
              0.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              2.0,
              1.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              3.0,
              1.0,
              2.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              4.0,
              2.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              5.0,
              2.0,
              2.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              1.0,
              1.0,
              1.0,
              6.9525,
              6.9525,
              0.1438,
              0.1438,
              2.0,
              0.1209,
              0.1209,
              0.8404,
              0.8404,
              0.1438,
              0.1438,
              0.0,
              1.0,
              1.0,
              1.0,
              6.9525,
              6.9525,
              0.1438,
              0.1438,
              1.0,
              2.0,
              0.1209,
              0.1209,
              0.8404,
              0.8404,
              0.1438,
              0.1438
            ]
          }
        }
      ],
      "execution_count": 7
    }
  },
  "numerical_summary": {
    "cell_1": [
      3.0,
      2.0,
      1.0,
      1.0,
      2.0
    ],
    "cell_2": [
      1.0,
      3.0,
      2.0,
      2.0,
      0.5,
      1.0,
      3.0,
      2.0,
      10.0,
      1.0,
      1.0,
      0.1,
      1.0,
      1.0,
      2.0,
      10.0,
      2.0,
      2.0,
      0.0,
      1.0,
      1.0,
      2.0,
      1.0,
      3.0,
      10.0,
      4.0,
      2.0,
      1.0,
      0.1,
      1.0,
      1.0,
      2.0,
      10.0,
      1.0,
      2.0,
      1.0,
      2.0
    ],
    "cell_3": [
      1.0,
      30.0,
      1.0,
      70.0,
      2.0,
      100.0,
      2.0
    ],
    "cell_5": [
      23000.0,
      2.0,
      23000.0,
      23000.0,
      23000.0,
      23000.0,
      23000.0,
      23000.0,
      23000.0
    ],
    "cell_6": [
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      2.0,
      0.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      2.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      2.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      2.0,
      2.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      2.0,
      0.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      2.0,
      1.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      3.0,
      1.0,
      2.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      4.0,
      2.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      5.0,
      2.0,
      2.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      1.0,
      1.0,
      1.0,
      6.9525,
      6.9525,
      0.1438,
      0.1438,
      2.0,
      0.1209,
      0.1209,
      0.8404,
      0.8404,
      0.1438,
      0.1438,
      0.0,
      1.0,
      1.0,
      1.0,
      6.9525,
      6.9525,
      0.1438,
      0.1438,
      1.0,
      2.0,
      0.1209,
      0.1209,
      0.8404,
      0.8404,
      0.1438,
      0.1438
    ]
  },
  "metadata": {
    "notebook_path": "closedQN/cqn_mmpp2_service.ipynb",
    "source_dir": "examples/basic",
    "total_cells": 7,
    "code_cells": 7,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}