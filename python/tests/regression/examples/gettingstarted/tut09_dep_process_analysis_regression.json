{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:28.115097Z",
          "start_time": "2025-07-27T17:24:28.111488Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:07.718220Z",
          "iopub.execute_input": "2026-01-03T15:31:07.718313Z",
          "shell.execute_reply": "2026-01-03T15:31:08.326552Z",
          "iopub.status.idle": "2026-01-03T15:31:08.326982Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "model, source, queue, sink, oclass = gallery_merl1()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:28.129313Z",
          "start_time": "2025-07-27T17:24:28.127013Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:08.328383Z",
          "iopub.execute_input": "2026-01-03T15:31:08.328604Z",
          "shell.execute_reply": "2026-01-03T15:31:08.330403Z",
          "iopub.status.idle": "2026-01-03T15:31:08.330807Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "solver = CTMC(model, cutoff=150, seed=23000, verbose=VerboseLevel.SILENT)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:28.178910Z",
          "start_time": "2025-07-27T17:24:28.175541Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:08.331907Z",
          "iopub.execute_input": "2026-01-03T15:31:08.332043Z",
          "shell.execute_reply": "2026-01-03T15:31:08.334833Z",
          "iopub.status.idle": "2026-01-03T15:31:08.335312Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "sa = solver.sample_sys_aggr(5000)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:34.578229Z",
          "start_time": "2025-07-27T17:24:28.225096Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:08.336304Z",
          "iopub.execute_input": "2026-01-03T15:31:08.336443Z",
          "shell.execute_reply": "2026-01-03T15:31:14.740299Z",
          "iopub.status.idle": "2026-01-03T15:31:14.740869Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "CTMC solver using state space cutoff = 150 for open/mixed model.\nCTMC state space size: 22801\n",
            "numerical_values": [
              150.0,
              22801.0
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "/home/gcasale/Dropbox/code/line-dev.git/python/line_solver/api/solvers/ctmc/handler.py:834: UserWarning: State space truncation may cause inaccurate results. Consider varying cutoff to assess sensitivity.\n  warnings.warn(\n",
            "numerical_values": [
              834.0
            ]
          }
        }
      ],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "ind = model.get_node_index(queue) - 1  # Convert to 0-based index for event comparison\n\n# Filter events for departures from the queue\ndep_times = []\nfor event in sa.event:\n    if event.node == ind and event.event == \"DEP\":\n        dep_times.append(event.t)\n\nprint(f\"Found {len(dep_times)} departure events from queue\")\n\nif len(dep_times) > 1:\n    inter_dep_times = np.diff(dep_times)\n    # Estimated squared coefficient of variation of departures\n    scv_d_est = np.var(inter_dep_times) / np.mean(inter_dep_times)**2\n    print(f\"Simulated SCV of departures: {scv_d_est}\")\nelse:\n    print(\"Error: Insufficient departure events found\")\n    print(f\"Total events generated: {len(sa.event)}\")\n    print(f\"Sample of events: {[(e.node, e.event, e.t) for e in sa.event[:5]]}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:34.592165Z",
          "start_time": "2025-07-27T17:24:34.588651Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:14.741944Z",
          "iopub.execute_input": "2026-01-03T15:31:14.742094Z",
          "shell.execute_reply": "2026-01-03T15:31:14.745252Z",
          "iopub.status.idle": "2026-01-03T15:31:14.745725Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Found 2500 departure events from queue\nSimulated SCV of departures: 0.9588183965303781\n",
            "numerical_values": [
              2500.0,
              0.9588183965303781
            ]
          }
        }
      ],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Get queue utilization and waiting time\nutil = solver.avg_util()\nutil_queue = util[queue][0]\navg_wait_time = solver.avg_wait_t()\navg_wait_time_queue = avg_wait_time[ind]",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:34.648956Z",
          "start_time": "2025-07-27T17:24:34.646781Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:14.746835Z",
          "iopub.execute_input": "2026-01-03T15:31:14.746937Z",
          "shell.execute_reply": "2026-01-03T15:31:14.748229Z",
          "iopub.status.idle": "2026-01-03T15:31:14.748598Z"
        }
      },
      "outputs": [],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "code",
      "source": "# Marshall's exact formula for SCV of departures\nscv_a = source.get_arrival(oclass).get_scv()\nsvc_rate = queue.get_service(oclass).get_rate()\nscv_s = queue.get_service(oclass).get_scv()\nscv_d = scv_a + 2*util_queue**2*scv_s - 2*util_queue*(1-util_queue)*svc_rate*avg_wait_time_queue\nprint(f\"Theoretical SCV of departures (Marshall's formula): {scv_d}\")\n\n# Calculate relative error between simulated and theoretical SCV  \nif 'scv_d_est' in locals():\n    relative_error = abs(scv_d_est - scv_d[0]) / scv_d[0] * 100\n    print(f\"\\n=== Departure Process Analysis Results ===\")\n    print(f\"Simulated SCV of departures:   {scv_d_est:.6f}\")\n    print(f\"Theoretical SCV (Marshall):    {scv_d[0]:.6f}\")\n    print(f\"Relative error:                {relative_error:.2f}%\")\nelse:\n    print(\"\\nCannot calculate relative error - simulation failed\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:26:10.656539Z",
          "start_time": "2025-07-27T17:26:10.563266Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-03T15:31:14.749416Z",
          "iopub.execute_input": "2026-01-03T15:31:14.749519Z",
          "shell.execute_reply": "2026-01-03T15:31:14.751729Z",
          "iopub.status.idle": "2026-01-03T15:31:14.752235Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Theoretical SCV of departures (Marshall's formula): [0.75]\n\n=== Departure Process Analysis Results ===\nSimulated SCV of departures:   0.958818\nTheoretical SCV (Marshall):    0.750000\nRelative error:                27.84%\n",
            "numerical_values": [
              0.75,
              0.958818,
              0.75,
              27.84
            ]
          }
        }
      ],
      "execution_count": 7
    }
  },
  "numerical_summary": {
    "cell_1": [
      1.0
    ],
    "cell_2": [
      150.0,
      23000.0
    ],
    "cell_3": [
      150.0,
      22801.0,
      834.0,
      5000.0
    ],
    "cell_4": [
      2500.0,
      0.9588183965303781,
      1.0,
      0.0,
      1.0,
      2.0,
      5.0
    ],
    "cell_5": [
      0.0
    ],
    "cell_6": [
      0.75,
      0.958818,
      0.75,
      27.84
    ]
  },
  "metadata": {
    "notebook_path": "tut09_dep_process_analysis.ipynb",
    "source_dir": "examples/gettingstarted",
    "total_cells": 7,
    "code_cells": 7,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}