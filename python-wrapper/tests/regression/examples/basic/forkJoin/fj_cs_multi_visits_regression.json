{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:16:52.350174Z",
          "start_time": "2025-07-30T22:16:51.525268Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:17.821059Z",
          "iopub.execute_input": "2026-01-02T14:09:17.821161Z",
          "iopub.status.idle": "2026-01-02T14:09:18.811231Z",
          "shell.execute_reply": "2026-01-02T14:09:18.810711Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "# Fork-Join network example 8 - fork-join with multiple visits within the same chain\nmodel = Network('model')",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:16:52.411732Z",
          "start_time": "2025-07-30T22:16:52.407980Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:18.812757Z",
          "iopub.execute_input": "2026-01-02T14:09:18.813031Z",
          "iopub.status.idle": "2026-01-02T14:09:18.821481Z",
          "shell.execute_reply": "2026-01-02T14:09:18.820980Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "# Create network\nsource = Source(model,'Source')\nqueue1 = Queue(model,'Queue1',SchedStrategy.PS)\nqueue2 = Queue(model,'Queue2',SchedStrategy.PS)\nfork = Fork(model,'Fork')\njoin = Join(model,'Join', fork)\nsink = Sink(model,'Sink')\n\njobclass1 = OpenClass(model, 'class1')\njobclass2 = OpenClass(model, 'class2')",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:16:52.470705Z",
          "start_time": "2025-07-30T22:16:52.459355Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:18.823685Z",
          "iopub.execute_input": "2026-01-02T14:09:18.823917Z",
          "iopub.status.idle": "2026-01-02T14:09:18.839492Z",
          "shell.execute_reply": "2026-01-02T14:09:18.839008Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "# Service configurations\nsource.set_arrival(jobclass1, Exp(0.1))\nqueue1.set_service(jobclass1, Exp(1.0))\nqueue2.set_service(jobclass1, Exp(1.0))\nqueue1.set_service(jobclass2, Exp(1.0))\nqueue2.set_service(jobclass2, Exp(1.0))",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:16:52.517153Z",
          "start_time": "2025-07-30T22:16:52.509787Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:18.840928Z",
          "iopub.execute_input": "2026-01-02T14:09:18.841110Z",
          "iopub.status.idle": "2026-01-02T14:09:18.848981Z",
          "shell.execute_reply": "2026-01-02T14:09:18.848515Z"
        }
      },
      "outputs": [],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Set routing matrix with class switching - multiple visits\nP = model.init_routing_matrix()\n\n# Class 1 initial routing\nP.set(jobclass1, jobclass1, source, fork, 1.0)\nP.set(jobclass1, jobclass1, fork, queue1, 1.0)\nP.set(jobclass1, jobclass1, fork, queue2, 1.0)\nP.set(jobclass1, jobclass1, queue1, join, 1.0)\nP.set(jobclass1, jobclass1, queue2, join, 1.0)\n\n# Class switching: class1 -> class2 after join\nP.set(jobclass1, jobclass2, join, fork, 1.0)\n\n# Class 2 routing\nP.set(jobclass2, jobclass2, fork, queue1, 1.0)\nP.set(jobclass2, jobclass2, fork, queue2, 1.0)\nP.set(jobclass2, jobclass2, queue1, join, 1.0)\nP.set(jobclass2, jobclass2, queue2, join, 1.0)\nP.set(jobclass2, jobclass2, join, sink, 1.0)\n\nmodel.link(P)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:16:52.577852Z",
          "start_time": "2025-07-30T22:16:52.560851Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:18.850718Z",
          "iopub.execute_input": "2026-01-02T14:09:18.850901Z",
          "iopub.status.idle": "2026-01-02T14:09:18.865025Z",
          "shell.execute_reply": "2026-01-02T14:09:18.864576Z"
        }
      },
      "outputs": [],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Solve with multiple methods\nsolvers = [MVA(model), JMT(model, seed=23000)]\nfor i, solver in enumerate(solvers):\n    print(f'SOLVER {i+1}: {solver.get_name()}')\n    avgTable = solver.avg_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:16:54.650841Z",
          "start_time": "2025-07-30T22:16:52.609089Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:18.866436Z",
          "iopub.execute_input": "2026-01-02T14:09:18.866671Z",
          "shell.execute_reply": "2026-01-02T14:09:21.233946Z",
          "iopub.status.idle": "2026-01-02T14:09:21.234222Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "SOLVER 1: SolverMVA\n",
            "numerical_values": [
              1.0
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "  Station JobClass    QLen  Util   RespT  ResidT  ArvR  Tput\n0  Source   class1  0.0000   0.0  0.0000  0.0000  0.00   0.1\n1  Queue1   class1  0.1247   0.1  1.2473  0.6236  0.10   0.1\n2  Queue1   class2  0.1247   0.1  1.2473  0.6236  0.05   0.1\n3  Queue2   class1  0.1247   0.1  1.2473  0.6236  0.10   0.1\n4  Queue2   class2  0.1247   0.1  1.2473  0.6236  0.05   0.1\n5    Join   class1  0.1247   0.0  0.6236  0.6236  0.20   0.1\n6    Join   class2  0.1247   0.0  0.6236  0.6236  0.10   0.1\nSOLVER 2: SolverJMT\nJMT Model: /tmp/workspace/jsim/15658757902779782884/jmodel.jsim\n",
            "numerical_values": [
              0.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.1,
              1.0,
              1.0,
              1.0,
              0.1247,
              0.1,
              1.2473,
              0.6236,
              0.1,
              0.1,
              2.0,
              1.0,
              2.0,
              0.1247,
              0.1,
              1.2473,
              0.6236,
              0.05,
              0.1,
              3.0,
              2.0,
              1.0,
              0.1247,
              0.1,
              1.2473,
              0.6236,
              0.1,
              0.1,
              4.0,
              2.0,
              2.0,
              0.1247,
              0.1,
              1.2473,
              0.6236,
              0.05,
              0.1,
              5.0,
              1.0,
              0.1247,
              0.0,
              0.6236,
              0.6236,
              0.2,
              0.1,
              6.0,
              2.0,
              0.1247,
              0.0,
              0.6236,
              0.6236,
              0.1,
              0.1,
              2.0,
              1.5658757902779783e+19
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0  Source   class1  0.0000  0.0000  0.0000  0.0000  0.0000  0.1021\n1  Queue1   class1  0.1306  0.1015  1.2685  0.6343  0.1021  0.1021\n2  Queue1   class2  0.1353  0.0992  1.3002  0.6501  0.1009  0.1009\n3  Queue2   class1  0.1260  0.0990  1.2527  0.6264  0.1021  0.1021\n4  Queue2   class2  0.1279  0.0981  1.2668  0.6334  0.1009  0.1009\n5    Join   class1  0.1349  0.0000  0.6519  0.6519  0.2081  0.1009\n6    Join   class2  0.1352  0.0000  0.6438  0.6438  0.2076  0.1009\n",
            "numerical_values": [
              0.0,
              1.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.0,
              0.1021,
              1.0,
              1.0,
              1.0,
              0.1306,
              0.1015,
              1.2685,
              0.6343,
              0.1021,
              0.1021,
              2.0,
              1.0,
              2.0,
              0.1353,
              0.0992,
              1.3002,
              0.6501,
              0.1009,
              0.1009,
              3.0,
              2.0,
              1.0,
              0.126,
              0.099,
              1.2527,
              0.6264,
              0.1021,
              0.1021,
              4.0,
              2.0,
              2.0,
              0.1279,
              0.0981,
              1.2668,
              0.6334,
              0.1009,
              0.1009,
              5.0,
              1.0,
              0.1349,
              0.0,
              0.6519,
              0.6519,
              0.2081,
              0.1009,
              6.0,
              2.0,
              0.1352,
              0.0,
              0.6438,
              0.6438,
              0.2076,
              0.1009
            ]
          }
        }
      ],
      "execution_count": 6
    }
  },
  "numerical_summary": {
    "cell_1": [
      8.0
    ],
    "cell_2": [
      1.0,
      1.0,
      2.0,
      2.0,
      1.0,
      1.0,
      2.0,
      2.0
    ],
    "cell_5": [
      1.0,
      0.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.1,
      1.0,
      1.0,
      1.0,
      0.1247,
      0.1,
      1.2473,
      0.6236,
      0.1,
      0.1,
      2.0,
      1.0,
      2.0,
      0.1247,
      0.1,
      1.2473,
      0.6236,
      0.05,
      0.1,
      3.0,
      2.0,
      1.0,
      0.1247,
      0.1,
      1.2473,
      0.6236,
      0.1,
      0.1,
      4.0,
      2.0,
      2.0,
      0.1247,
      0.1,
      1.2473,
      0.6236,
      0.05,
      0.1,
      5.0,
      1.0,
      0.1247,
      0.0,
      0.6236,
      0.6236,
      0.2,
      0.1,
      6.0,
      2.0,
      0.1247,
      0.0,
      0.6236,
      0.6236,
      0.1,
      0.1,
      2.0,
      1.5658757902779783e+19,
      0.0,
      1.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.0,
      0.1021,
      1.0,
      1.0,
      1.0,
      0.1306,
      0.1015,
      1.2685,
      0.6343,
      0.1021,
      0.1021,
      2.0,
      1.0,
      2.0,
      0.1353,
      0.0992,
      1.3002,
      0.6501,
      0.1009,
      0.1009,
      3.0,
      2.0,
      1.0,
      0.126,
      0.099,
      1.2527,
      0.6264,
      0.1021,
      0.1021,
      4.0,
      2.0,
      2.0,
      0.1279,
      0.0981,
      1.2668,
      0.6334,
      0.1009,
      0.1009,
      5.0,
      1.0,
      0.1349,
      0.0,
      0.6519,
      0.6519,
      0.2081,
      0.1009,
      6.0,
      2.0,
      0.1352,
      0.0,
      0.6438,
      0.6438,
      0.2076,
      0.1009,
      23000.0,
      1.0
    ]
  },
  "metadata": {
    "notebook_path": "forkJoin/fj_cs_multi_visits.ipynb",
    "source_dir": "examples/basic",
    "total_cells": 6,
    "code_cells": 6,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}