{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:17:22.370585Z",
          "start_time": "2025-07-30T22:17:21.446818Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:30.758353Z",
          "iopub.execute_input": "2026-01-02T14:09:30.758492Z",
          "shell.execute_reply": "2026-01-02T14:09:31.688682Z",
          "iopub.status.idle": "2026-01-02T14:09:31.689134Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "# Nested Fork-Join Network\nmodel = Network('model')",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:17:22.422282Z",
          "start_time": "2025-07-30T22:17:22.418482Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:31.690467Z",
          "iopub.execute_input": "2026-01-02T14:09:31.690719Z",
          "shell.execute_reply": "2026-01-02T14:09:31.694773Z",
          "iopub.status.idle": "2026-01-02T14:09:31.695078Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "# Create nested fork-join structure\ndelay = Delay(model, 'Delay1')\nqueue1 = Queue(model,'Queue1',SchedStrategy.FCFS)\nqueue2 = Queue(model,'Queue2',SchedStrategy.FCFS)\nfork = Fork(model,'Fork')\njoin = Join(model,'Join', fork)\nqueue3 = Queue(model,'Queue3',SchedStrategy.FCFS)\nqueue4 = Queue(model,'Queue4',SchedStrategy.FCFS)\nfork2 = Fork(model,'Fork2')\njoin2 = Join(model,'Join2', fork2)\n\njobclass1 = ClosedClass(model, 'class1', 1, delay, 0)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:17:22.482470Z",
          "start_time": "2025-07-30T22:17:22.472027Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:31.695998Z",
          "iopub.execute_input": "2026-01-02T14:09:31.696112Z",
          "shell.execute_reply": "2026-01-02T14:09:31.704109Z",
          "iopub.status.idle": "2026-01-02T14:09:31.704388Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "# Service configurations\nqueue1.set_service(jobclass1, Exp(1.0))\nqueue2.set_service(jobclass1, Exp(1.0))\ndelay.set_service(jobclass1, Exp(0.5))\nqueue3.set_service(jobclass1, Exp(2.0))\nqueue4.set_service(jobclass1, Exp(2.0))",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:17:22.534566Z",
          "start_time": "2025-07-30T22:17:22.529571Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:31.705573Z",
          "iopub.execute_input": "2026-01-02T14:09:31.705704Z",
          "shell.execute_reply": "2026-01-02T14:09:31.710667Z",
          "iopub.status.idle": "2026-01-02T14:09:31.711060Z"
        }
      },
      "outputs": [],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Nested fork-join routing\nP = model.init_routing_matrix()\n\nP.set(jobclass1, jobclass1, delay, fork, 1.0)\nP.set(jobclass1, jobclass1, fork, queue1, 1.0)\nP.set(jobclass1, jobclass1, fork, queue2, 1.0)\n# Nested structure: queue1 goes to fork2\nP.set(jobclass1, jobclass1, queue1, fork2, 1.0)\nP.set(jobclass1, jobclass1, fork2, queue3, 1.0)\nP.set(jobclass1, jobclass1, fork2, queue4, 1.0)\nP.set(jobclass1, jobclass1, queue3, join2, 1.0)\nP.set(jobclass1, jobclass1, queue4, join2, 1.0)\nP.set(jobclass1, jobclass1, join2, join, 1.0)\n# Queue2 goes directly to join\nP.set(jobclass1, jobclass1, queue2, join, 1.0)\nP.set(jobclass1, jobclass1, join, delay, 1.0)\n\nmodel.link(P)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:17:22.592494Z",
          "start_time": "2025-07-30T22:17:22.581749Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:31.712179Z",
          "iopub.execute_input": "2026-01-02T14:09:31.712307Z",
          "shell.execute_reply": "2026-01-02T14:09:31.719403Z",
          "iopub.status.idle": "2026-01-02T14:09:31.719734Z"
        }
      },
      "outputs": [],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Solve with multiple methods\nsolvers = [JMT(model, seed=23000)]\n# Add MVA with special fork-join options\nmva_options = MVA.default_options()\nmva_options.config.fork_join = 'fjt'\nsolvers.append(MVA(model, mva_options))\n\nfor i, solver in enumerate(solvers):\n    print(f'SOLVER {i+1}: {solver.get_name()}')\n    avgTable = solver.avg_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-30T22:17:23.877618Z",
          "start_time": "2025-07-30T22:17:22.628916Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:09:31.720855Z",
          "iopub.execute_input": "2026-01-02T14:09:31.721014Z",
          "iopub.status.idle": "2026-01-02T14:09:32.985794Z",
          "shell.execute_reply": "2026-01-02T14:09:32.985345Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "SOLVER 1: SolverJMT\nJMT Model: /tmp/workspace/jsim/2165598245320295294/jmodel.jsim\n",
            "numerical_values": [
              1.0,
              2.1655982453202952e+18
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0  Delay1   class1  0.5038  0.5038  1.9924  1.9924  0.2505  0.2496\n1  Queue1   class1  0.2431  0.2431  0.9990  0.4995  0.2496  0.2496\n2  Queue2   class1  0.2518  0.2518  0.9906  0.4953  0.2496  0.2496\n3    Join   class1  0.3067  0.0000  0.6164  0.6164  0.5051  0.2496\n4  Queue3   class1  0.1247  0.1247  0.4897  0.1224  0.2496  0.2496\n5  Queue4   class1  0.1226  0.1226  0.4926  0.1232  0.2496  0.2496\n6   Join2   class1  0.1258  0.0000  0.2453  0.1227  0.5001  0.2496\nSOLVER 2: SolverMVA\n",
            "numerical_values": [
              0.0,
              1.0,
              1.0,
              0.5038,
              0.5038,
              1.9924,
              1.9924,
              0.2505,
              0.2496,
              1.0,
              1.0,
              1.0,
              0.2431,
              0.2431,
              0.999,
              0.4995,
              0.2496,
              0.2496,
              2.0,
              2.0,
              1.0,
              0.2518,
              0.2518,
              0.9906,
              0.4953,
              0.2496,
              0.2496,
              3.0,
              1.0,
              0.3067,
              0.0,
              0.6164,
              0.6164,
              0.5051,
              0.2496,
              4.0,
              3.0,
              1.0,
              0.1247,
              0.1247,
              0.4897,
              0.1224,
              0.2496,
              0.2496,
              5.0,
              4.0,
              1.0,
              0.1226,
              0.1226,
              0.4926,
              0.1232,
              0.2496,
              0.2496,
              6.0,
              2.0,
              1.0,
              0.1258,
              0.0,
              0.2453,
              0.1227,
              0.5001,
              0.2496,
              2.0
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "  Station JobClass    QLen    Util   RespT  ResidT    ArvR    Tput\n0  Delay1   class1  0.4519  0.4519  2.0000  2.0000  0.2260  0.2260\n1  Queue1   class1  0.2731  0.2260  1.2084  0.6042  0.1130  0.2260\n2  Queue2   class1  0.2731  0.2260  1.2084  0.6042  0.1130  0.2260\n3    Join   class1  0.3923  0.0000  0.8680  0.8680  0.2260  0.2260\n4  Queue3   class1  0.1263  0.1129  0.5593  0.1398  0.1695  0.2259\n5  Queue4   class1  0.1263  0.1129  0.5593  0.1398  0.1695  0.2259\n6   Join2   class1  0.1262  0.0000  0.2234  0.1117  0.3389  0.2260\n",
            "numerical_values": [
              0.0,
              1.0,
              1.0,
              0.4519,
              0.4519,
              2.0,
              2.0,
              0.226,
              0.226,
              1.0,
              1.0,
              1.0,
              0.2731,
              0.226,
              1.2084,
              0.6042,
              0.113,
              0.226,
              2.0,
              2.0,
              1.0,
              0.2731,
              0.226,
              1.2084,
              0.6042,
              0.113,
              0.226,
              3.0,
              1.0,
              0.3923,
              0.0,
              0.868,
              0.868,
              0.226,
              0.226,
              4.0,
              3.0,
              1.0,
              0.1263,
              0.1129,
              0.5593,
              0.1398,
              0.1695,
              0.2259,
              5.0,
              4.0,
              1.0,
              0.1263,
              0.1129,
              0.5593,
              0.1398,
              0.1695,
              0.2259,
              6.0,
              2.0,
              1.0,
              0.1262,
              0.0,
              0.2234,
              0.1117,
              0.3389,
              0.226
            ]
          }
        }
      ],
      "execution_count": 6
    }
  },
  "numerical_summary": {
    "cell_5": [
      1.0,
      2.1655982453202952e+18,
      0.0,
      1.0,
      1.0,
      0.5038,
      0.5038,
      1.9924,
      1.9924,
      0.2505,
      0.2496,
      1.0,
      1.0,
      1.0,
      0.2431,
      0.2431,
      0.999,
      0.4995,
      0.2496,
      0.2496,
      2.0,
      2.0,
      1.0,
      0.2518,
      0.2518,
      0.9906,
      0.4953,
      0.2496,
      0.2496,
      3.0,
      1.0,
      0.3067,
      0.0,
      0.6164,
      0.6164,
      0.5051,
      0.2496,
      4.0,
      3.0,
      1.0,
      0.1247,
      0.1247,
      0.4897,
      0.1224,
      0.2496,
      0.2496,
      5.0,
      4.0,
      1.0,
      0.1226,
      0.1226,
      0.4926,
      0.1232,
      0.2496,
      0.2496,
      6.0,
      2.0,
      1.0,
      0.1258,
      0.0,
      0.2453,
      0.1227,
      0.5001,
      0.2496,
      2.0,
      0.0,
      1.0,
      1.0,
      0.4519,
      0.4519,
      2.0,
      2.0,
      0.226,
      0.226,
      1.0,
      1.0,
      1.0,
      0.2731,
      0.226,
      1.2084,
      0.6042,
      0.113,
      0.226,
      2.0,
      2.0,
      1.0,
      0.2731,
      0.226,
      1.2084,
      0.6042,
      0.113,
      0.226,
      3.0,
      1.0,
      0.3923,
      0.0,
      0.868,
      0.868,
      0.226,
      0.226,
      4.0,
      3.0,
      1.0,
      0.1263,
      0.1129,
      0.5593,
      0.1398,
      0.1695,
      0.2259,
      5.0,
      4.0,
      1.0,
      0.1263,
      0.1129,
      0.5593,
      0.1398,
      0.1695,
      0.2259,
      6.0,
      2.0,
      1.0,
      0.1262,
      0.0,
      0.2234,
      0.1117,
      0.3389,
      0.226,
      23000.0,
      1.0
    ]
  },
  "metadata": {
    "notebook_path": "forkJoin/fj_deep_nesting.ipynb",
    "source_dir": "examples/basic",
    "total_cells": 6,
    "code_cells": 6,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}