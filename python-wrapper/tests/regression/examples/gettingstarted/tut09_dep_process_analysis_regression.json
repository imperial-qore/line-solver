{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:28.115097Z",
          "start_time": "2025-07-27T17:24:28.111488Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:38.702195Z",
          "iopub.execute_input": "2026-01-02T14:07:38.702323Z",
          "iopub.status.idle": "2026-01-02T14:07:39.481034Z",
          "shell.execute_reply": "2026-01-02T14:07:39.480578Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "model, source, queue, sink, oclass = gallery_merl1()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:28.129313Z",
          "start_time": "2025-07-27T17:24:28.127013Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:39.482588Z",
          "iopub.execute_input": "2026-01-02T14:07:39.482866Z",
          "shell.execute_reply": "2026-01-02T14:07:39.502264Z",
          "iopub.status.idle": "2026-01-02T14:07:39.502586Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "solver = CTMC(model, cutoff=150, seed=23000, verbose=VerboseLevel.SILENT)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:28.178910Z",
          "start_time": "2025-07-27T17:24:28.175541Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:39.504129Z",
          "iopub.execute_input": "2026-01-02T14:07:39.504443Z",
          "iopub.status.idle": "2026-01-02T14:07:39.557328Z",
          "shell.execute_reply": "2026-01-02T14:07:39.556802Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "sa = solver.sample_sys_aggr(5000)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:34.578229Z",
          "start_time": "2025-07-27T17:24:28.225096Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:39.558709Z",
          "iopub.execute_input": "2026-01-02T14:07:39.558897Z",
          "iopub.status.idle": "2026-01-02T14:07:46.348091Z",
          "shell.execute_reply": "2026-01-02T14:07:46.347829Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "WARNING: [Object[]] CTMC solver using state space cutoff = 150 for open/mixed model. State space truncation may cause inaccurate results. Consider varying cutoff to assess sensitivity.\n",
            "numerical_values": [
              150.0
            ]
          }
        }
      ],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "ind = model.get_node_index(queue)\n\n# Filter events for departures from the queue\ndep_times = []\nfor event in sa.event:\n    if event.node == ind and event.event == \"DEP\":\n        dep_times.append(event.t)\n\nprint(f\"Found {len(dep_times)} departure events from queue\")\n\nif len(dep_times) > 1:\n    inter_dep_times = np.diff(dep_times)\n    # Estimated squared coefficient of variation of departures\n    scv_d_est = np.var(inter_dep_times) / np.mean(inter_dep_times)**2\n    print(f\"Simulated SCV of departures: {scv_d_est}\")\nelse:\n    print(\"Error: Insufficient departure events found\")\n    print(f\"Total events generated: {len(sa.event)}\")\n    print(f\"Sample of events: {[(e.node, e.event, e.t) for e in sa.event[:5]]}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:34.592165Z",
          "start_time": "2025-07-27T17:24:34.588651Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:46.349094Z",
          "iopub.execute_input": "2026-01-02T14:07:46.349192Z",
          "iopub.status.idle": "2026-01-02T14:07:46.352915Z",
          "shell.execute_reply": "2026-01-02T14:07:46.352661Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Found 1666 departure events from queue\nSimulated SCV of departures: 0.9163629630210565\n",
            "numerical_values": [
              1666.0,
              0.9163629630210565
            ]
          }
        }
      ],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Get queue utilization and waiting time\nutil = solver.avg_util()\nutil_queue = util[queue][0]\navg_wait_time = solver.avg_wait_t()\navg_wait_time_queue = avg_wait_time[ind]",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:24:34.648956Z",
          "start_time": "2025-07-27T17:24:34.646781Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:46.353704Z",
          "iopub.execute_input": "2026-01-02T14:07:46.353797Z",
          "iopub.status.idle": "2026-01-02T14:07:46.356083Z",
          "shell.execute_reply": "2026-01-02T14:07:46.355755Z"
        }
      },
      "outputs": [],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "code",
      "source": "# Marshall's exact formula for SCV of departures\nscv_a = source.get_arrival_process(oclass).get_scv()\nsvc_rate = queue.get_service_process(oclass).get_rate()\nscv_s = queue.get_service_process(oclass).get_scv()\nscv_d = scv_a + 2*util_queue**2*scv_s - 2*util_queue*(1-util_queue)*svc_rate*avg_wait_time_queue\nprint(f\"Theoretical SCV of departures (Marshall's formula): {scv_d}\")\n\n# Calculate relative error between simulated and theoretical SCV  \nif 'scv_d_est' in locals():\n    relative_error = abs(scv_d_est - scv_d[0]) / scv_d[0] * 100\n    print(f\"\\n=== Departure Process Analysis Results ===\")\n    print(f\"Simulated SCV of departures:   {scv_d_est:.6f}\")\n    print(f\"Theoretical SCV (Marshall):    {scv_d[0]:.6f}\")\n    print(f\"Relative error:                {relative_error:.2f}%\")\nelse:\n    print(\"\\nCannot calculate relative error - simulation failed\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-27T17:26:10.656539Z",
          "start_time": "2025-07-27T17:26:10.563266Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:07:46.357093Z",
          "iopub.execute_input": "2026-01-02T14:07:46.357237Z",
          "iopub.status.idle": "2026-01-02T14:07:46.360177Z",
          "shell.execute_reply": "2026-01-02T14:07:46.359945Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Theoretical SCV of departures (Marshall's formula): [0.875]\n\n=== Departure Process Analysis Results ===\nSimulated SCV of departures:   0.916363\nTheoretical SCV (Marshall):    0.875000\nRelative error:                4.73%\n",
            "numerical_values": [
              0.875,
              0.916363,
              0.875,
              4.73
            ]
          }
        }
      ],
      "execution_count": 7
    }
  },
  "numerical_summary": {
    "cell_1": [
      1.0
    ],
    "cell_2": [
      150.0,
      23000.0
    ],
    "cell_3": [
      150.0,
      5000.0
    ],
    "cell_4": [
      1666.0,
      0.9163629630210565,
      1.0,
      2.0,
      5.0
    ],
    "cell_5": [
      0.0
    ],
    "cell_6": [
      0.875,
      0.916363,
      0.875,
      4.73
    ]
  },
  "metadata": {
    "notebook_path": "tut09_dep_process_analysis.ipynb",
    "source_dir": "examples/gettingstarted",
    "total_cells": 7,
    "code_cells": 7,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}