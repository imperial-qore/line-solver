{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nimport numpy as np\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.483039Z",
          "start_time": "2025-07-29T11:14:27.564278Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:53.524079Z",
          "iopub.execute_input": "2026-01-02T14:15:53.524174Z",
          "iopub.status.idle": "2026-01-02T14:15:54.387286Z",
          "shell.execute_reply": "2026-01-02T14:15:54.386926Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "# Create network\nmodel = Network('model')\n\n# Block 1: nodes\nnode1 = Delay(model, 'Delay')\nnode2 = Queue(model, 'Queue1', SchedStrategy.PS)\nnode3 = Queue(model, 'Queue2', SchedStrategy.FCFS)  # FCFS instead of PS\nnode3.set_number_of_servers(2)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.567978Z",
          "start_time": "2025-07-29T11:14:28.546980Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.388485Z",
          "iopub.execute_input": "2026-01-02T14:15:54.388714Z",
          "shell.execute_reply": "2026-01-02T14:15:54.399274Z",
          "iopub.status.idle": "2026-01-02T14:15:54.399573Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "# Block 2: classes\nN = [2, 0]  # Class1: 2 jobs, Class2: 0 jobs\njobclass1 = ClosedClass(model, 'Class1', N[0], node1, 0)\njobclass2 = ClosedClass(model, 'Class2', N[1], node1, 0)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.601372Z",
          "start_time": "2025-07-29T11:14:28.597503Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.400611Z",
          "iopub.execute_input": "2026-01-02T14:15:54.400726Z",
          "shell.execute_reply": "2026-01-02T14:15:54.403602Z",
          "iopub.status.idle": "2026-01-02T14:15:54.403960Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "# Set service times\nnode1.set_service(jobclass1, Exp.fit_mean(1.0))\nnode1.set_service(jobclass2, Exp.fit_mean(1.0))\n\nnode2.set_service(jobclass1, Exp.fit_mean(1.0/3.0))\nnode2.set_service(jobclass2, Exp.fit_mean(1.0/4.0))\n\n# FCFS queue with same service time for both classes\nnode3.set_service(jobclass1, Exp.fit_mean(1.0/3.0))\nnode3.set_service(jobclass2, Exp.fit_mean(1.0/3.0))",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.654944Z",
          "start_time": "2025-07-29T11:14:28.649364Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.405075Z",
          "iopub.execute_input": "2026-01-02T14:15:54.405198Z",
          "shell.execute_reply": "2026-01-02T14:15:54.410615Z",
          "iopub.status.idle": "2026-01-02T14:15:54.410955Z"
        }
      },
      "outputs": [],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Block 3: routing with class switching\nP = model.init_routing_matrix()\n\n# Class1 routing: Delay -> Queue1 (stay Class1), Queue2 -> Delay (switch to Class2)\nP.set(jobclass1, jobclass1, node1, node2, 1.0)  # Delay -> Queue1\nP.set(jobclass1, jobclass2, node2, node3, 1.0)  # Queue1 -> Queue2 (switch to Class2)\n\n# Class2 routing: Queue2 -> Delay (switch to Class1)\nP.set(jobclass2, jobclass1, node1, node2, 1.0)  # Delay -> Queue1 (switch to Class1)\nP.set(jobclass2, jobclass2, node2, node3, 1.0)  # Queue1 -> Queue2\nP.set(jobclass2, jobclass1, node3, node1, 1.0)  # Queue2 -> Delay (switch to Class1)\n\nmodel.link(P)",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.712018Z",
          "start_time": "2025-07-29T11:14:28.697660Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.412239Z",
          "iopub.execute_input": "2026-01-02T14:15:54.412365Z",
          "shell.execute_reply": "2026-01-02T14:15:54.421023Z",
          "iopub.status.idle": "2026-01-02T14:15:54.421354Z"
        }
      },
      "outputs": [],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Set specific state for probability calculation\nn = np.array([[0,0],   # Delay: no jobs\n              [1,0],   # Queue1: 1 job of Class1\n              [0,1]])  # Queue2: 1 job of Class2\n\nnodes = [node1, node2, node3]\nfor i in range(len(nodes)):\n    nodes[i].set_state(n[i])\n\nstate = model.state()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.768808Z",
          "start_time": "2025-07-29T11:14:28.749524Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.422689Z",
          "iopub.execute_input": "2026-01-02T14:15:54.422907Z",
          "shell.execute_reply": "2026-01-02T14:15:54.434498Z",
          "iopub.status.idle": "2026-01-02T14:15:54.434880Z"
        }
      },
      "outputs": [],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "code",
      "source": "# Solver options\noptions = Solver.defaultOptions\noptions.verbose = 1\noptions.samples = 20000\noptions.seed = 23001  # Different seed from example 5",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:28.800686Z",
          "start_time": "2025-07-29T11:14:28.798857Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.435996Z",
          "iopub.execute_input": "2026-01-02T14:15:54.436118Z",
          "shell.execute_reply": "2026-01-02T14:15:54.437597Z",
          "iopub.status.idle": "2026-01-02T14:15:54.437959Z"
        }
      },
      "outputs": [],
      "execution_count": 7
    },
    "cell_7": {
      "cell_type": "code",
      "source": "# Method 1: getProbAggr - Marginal probabilities for aggregated state\ntry:\n    solver_ctmc = CTMC(model, options)\n    Pr = solver_ctmc.prob_aggr(node3)\n    print(f\"CTMC prob_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"CTMC prob_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:37.704602Z",
          "start_time": "2025-07-29T11:14:37.632127Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.438919Z",
          "iopub.execute_input": "2026-01-02T14:15:54.439041Z",
          "shell.execute_reply": "2026-01-02T14:15:54.516520Z",
          "iopub.status.idle": "2026-01-02T14:15:54.516797Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "\nCTMC generator and state space saved in: /home/gcasale/Dropbox/code/line-dev.git/python/workspace/workspace_1767363354485.mat.mat\nCTMC prob_aggr: 0.3076923076923077\n",
            "numerical_values": [
              1767363354485.0,
              0.3076923076923077
            ]
          }
        }
      ],
      "execution_count": 8
    },
    "cell_8": {
      "cell_type": "code",
      "source": "try:\n    solver_nc = NC(model, options)\n    Pr = solver_nc.prob_aggr(node3)\n    print(f\"NC prob_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"NC prob_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.162863500Z",
          "start_time": "2025-07-14T18:46:17.913650Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.517596Z",
          "iopub.execute_input": "2026-01-02T14:15:54.517694Z",
          "shell.execute_reply": "2026-01-02T14:15:54.588240Z",
          "iopub.status.idle": "2026-01-02T14:15:54.588575Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "NC prob_aggr: 0.3076923076923076\n",
            "numerical_values": [
              0.3076923076923076
            ]
          }
        }
      ],
      "execution_count": 9
    },
    "cell_9": {
      "cell_type": "code",
      "source": "try:\n    solver_ssa = SSA(model, options)\n    Pr = solver_ssa.prob_aggr(node3)\n    print(f\"SSA prob_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"SSA prob_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.164739200Z",
          "start_time": "2025-07-14T18:46:17.913650Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.589494Z",
          "iopub.execute_input": "2026-01-02T14:15:54.589589Z",
          "shell.execute_reply": "2026-01-02T14:15:54.657224Z",
          "iopub.status.idle": "2026-01-02T14:15:54.657537Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "SSA prob_aggr failed: org.ejml.MatrixDimensionException\n"
          }
        }
      ],
      "execution_count": 10
    },
    "cell_10": {
      "cell_type": "code",
      "source": "try:\n    solver_jmt = JMT(model, options)\n    Pr = solver_jmt.prob_aggr(node3)\n    print(f\"JMT prob_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"JMT prob_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.165786Z",
          "start_time": "2025-07-14T18:46:17.913650Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:54.658605Z",
          "iopub.execute_input": "2026-01-02T14:15:54.658713Z",
          "iopub.status.idle": "2026-01-02T14:15:56.767537Z",
          "shell.execute_reply": "2026-01-02T14:15:56.767298Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "JMT Model: /tmp/workspace/jsim/10153510865564733013/jmodel.jsim\n",
            "numerical_values": [
              1.0153510865564733e+19
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stderr",
            "text": "WARNING: [SolverJMT] JMT does not allow to fix the number of events for individual nodes. The number of returned events may be inaccurate.\nWARNING: [SolverJMT] Message casted more than once, repetitions will not be printed on screen for 60 seconds.\n",
            "numerical_values": [
              60.0
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "JMT prob_aggr: 0.0\n",
            "numerical_values": [
              0.0
            ]
          }
        }
      ],
      "execution_count": 11
    },
    "cell_11": {
      "cell_type": "code",
      "source": "# Method 2: getProb - Marginal probabilities for detailed state\ntry:\n    solver_ctmc = CTMC(model, options)\n    Pr = solver_ctmc.prob(node3)\n    print(f\"CTMC prob: {Pr}\")\nexcept Exception as e:\n    print(f\"CTMC prob failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.167153700Z",
          "start_time": "2025-07-14T18:46:23.778822Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:56.768456Z",
          "iopub.execute_input": "2026-01-02T14:15:56.768550Z",
          "iopub.status.idle": "2026-01-02T14:15:56.770923Z",
          "shell.execute_reply": "2026-01-02T14:15:56.770657Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "CTMC getTranProb failed: java.lang.RuntimeException: getTranProb in SolverCTMC requires to specify a finite timespan T, e.g., SolverCTMC(model, options.timespan([0,T])).\nCTMC prob: None\n",
            "numerical_values": [
              0.0
            ]
          }
        }
      ],
      "execution_count": 12
    },
    "cell_12": {
      "cell_type": "code",
      "source": "try:\n    solver_ssa = SSA(model, options)\n    Pr = solver_ssa.prob(node3)\n    print(f\"SSA prob: {Pr}\")\nexcept Exception as e:\n    print(f\"SSA prob failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.168194400Z",
          "start_time": "2025-07-14T18:46:23.778822Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:56.771657Z",
          "iopub.execute_input": "2026-01-02T14:15:56.771745Z",
          "shell.execute_reply": "2026-01-02T14:15:56.773629Z",
          "iopub.status.idle": "2026-01-02T14:15:56.773881Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "SSA getTranProb failed: 'jline.solvers.ssa.SolverSSA' object has no attribute 'getTranProb'\nSSA prob: None\n"
          }
        }
      ],
      "execution_count": 13
    },
    "cell_13": {
      "cell_type": "code",
      "source": "# Method 3: getProbSysAggr - Joint system probabilities for aggregated state\ntry:\n    solver_ctmc = CTMC(model, options)\n    Pr = solver_ctmc.prob_sys_aggr()\n    print(f\"CTMC prob_sys_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"CTMC prob_sys_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.168194400Z",
          "start_time": "2025-07-14T18:46:26.697231Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:56.774630Z",
          "iopub.execute_input": "2026-01-02T14:15:56.774729Z",
          "iopub.status.idle": "2026-01-02T14:15:56.782283Z",
          "shell.execute_reply": "2026-01-02T14:15:56.781960Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "CTMC prob_sys_aggr: <line_solver.solvers.ProbabilityResult object at 0x774b716d57f0>\n",
            "numerical_values": [
              0.0,
              774.0,
              716.0,
              57.0,
              0.0
            ]
          }
        }
      ],
      "execution_count": 14
    },
    "cell_14": {
      "cell_type": "code",
      "source": "try:\n    solver_nc = NC(model, options)\n    Pr = solver_nc.prob_sys_aggr()\n    print(f\"NC prob_sys_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"NC prob_sys_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.168194400Z",
          "start_time": "2025-07-14T18:46:26.697231Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:56.783205Z",
          "iopub.execute_input": "2026-01-02T14:15:56.783343Z",
          "shell.execute_reply": "2026-01-02T14:15:56.939725Z",
          "iopub.status.idle": "2026-01-02T14:15:56.940073Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "NC prob_sys_aggr: <line_solver.solvers.ProbabilityResult object at 0x774b716f4690>\n",
            "numerical_values": [
              0.0,
              774.0,
              716.0,
              4690.0
            ]
          }
        }
      ],
      "execution_count": 15
    },
    "cell_15": {
      "cell_type": "code",
      "source": "try:\n    solver_ssa = SSA(model, options)\n    Pr = solver_ssa.prob_sys_aggr()\n    print(f\"SSA prob_sys_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"SSA prob_sys_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.169232500Z",
          "start_time": "2025-07-14T18:46:26.697231Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:56.941054Z",
          "iopub.execute_input": "2026-01-02T14:15:56.941152Z",
          "iopub.status.idle": "2026-01-02T14:15:56.943325Z",
          "shell.execute_reply": "2026-01-02T14:15:56.943029Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "SSA prob_sys_aggr failed: AttributeError\n"
          }
        }
      ],
      "execution_count": 16
    },
    "cell_16": {
      "cell_type": "code",
      "source": "try:\n    solver_jmt = JMT(model, options)\n    Pr = solver_jmt.prob_sys_aggr()\n    print(f\"JMT prob_sys_aggr: {Pr}\")\nexcept Exception as e:\n    print(f\"JMT prob_sys_aggr failed: {type(e).__name__}\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-29T11:14:29.169232500Z",
          "start_time": "2025-07-14T18:46:26.697231Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:56.944256Z",
          "iopub.execute_input": "2026-01-02T14:15:56.944387Z",
          "iopub.status.idle": "2026-01-02T14:16:00.028263Z",
          "shell.execute_reply": "2026-01-02T14:16:00.027888Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "JMT Model: /tmp/workspace/jsim/11615155256072724807/jmodel.jsim\n",
            "numerical_values": [
              1.1615155256072724e+19
            ]
          }
        },
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "JMT prob_sys_aggr: <line_solver.solvers.ProbabilityResult object at 0x774b716f5450>\n",
            "numerical_values": [
              0.0,
              774.0,
              716.0,
              5450.0
            ]
          }
        }
      ],
      "execution_count": 17
    },
    "cell_17": {
      "cell_type": "code",
      "source": "# Method 4: getProbSys - Joint system probabilities for detailed state\ntry:\n    solver_ctmc = CTMC(model, options)\n    Pr = solver_ctmc.prob_sys()\n    print(f\"CTMC prob_sys: {Pr}\")\nexcept Exception as e:\n    print(f\"CTMC prob_sys failed: {type(e).__name__}\")",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-02T14:16:00.029661Z",
          "iopub.execute_input": "2026-01-02T14:16:00.029811Z",
          "iopub.status.idle": "2026-01-02T14:16:00.032368Z",
          "shell.execute_reply": "2026-01-02T14:16:00.031929Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "CTMC prob_sys failed: AttributeError\n"
          }
        }
      ],
      "execution_count": 18
    },
    "cell_18": {
      "cell_type": "code",
      "source": "try:\n    solver_ssa = SSA(model, options)\n    Pr = solver_ssa.prob_sys()\n    print(f\"SSA prob_sys: {Pr}\")\nexcept Exception as e:\n    print(f\"SSA prob_sys failed: {type(e).__name__}\")",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-02T14:16:00.033950Z",
          "iopub.execute_input": "2026-01-02T14:16:00.034115Z",
          "iopub.status.idle": "2026-01-02T14:16:00.036794Z",
          "shell.execute_reply": "2026-01-02T14:16:00.036345Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "SSA prob_sys failed: AttributeError\n"
          }
        }
      ],
      "execution_count": 19
    }
  },
  "numerical_summary": {
    "cell_1": [
      1.0,
      1.0,
      2.0,
      1.0,
      3.0,
      2.0,
      3.0,
      2.0
    ],
    "cell_6": [
      1.0,
      20000.0,
      23001.0,
      5.0
    ],
    "cell_7": [
      1767363354485.0,
      0.3076923076923077,
      1.0,
      3.0
    ],
    "cell_8": [
      0.3076923076923076,
      3.0
    ],
    "cell_9": [
      3.0
    ],
    "cell_10": [
      1.0153510865564733e+19,
      60.0,
      0.0,
      3.0
    ],
    "cell_11": [
      0.0,
      2.0,
      3.0
    ],
    "cell_12": [
      3.0
    ],
    "cell_13": [
      0.0,
      774.0,
      716.0,
      57.0,
      0.0,
      3.0
    ],
    "cell_14": [
      0.0,
      774.0,
      716.0,
      4690.0
    ],
    "cell_16": [
      1.1615155256072724e+19,
      0.0,
      774.0,
      716.0,
      5450.0
    ],
    "cell_17": [
      4.0
    ]
  },
  "metadata": {
    "notebook_path": "stateProbabilities/statepr_allprobs_fcfs.ipynb",
    "source_dir": "examples/advanced",
    "total_cells": 19,
    "code_cells": 19,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}