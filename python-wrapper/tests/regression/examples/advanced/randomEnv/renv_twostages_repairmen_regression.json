{
  "cell_content": {
    "cell_0": {
      "cell_type": "code",
      "source": "from line_solver import *\nGlobalConstants.set_verbose(VerboseLevel.STD)",
      "metadata": {
        "collapsed": false,
        "ExecuteTime": {
          "end_time": "2025-07-15T22:53:57.966996Z",
          "start_time": "2025-07-15T22:53:53.073175Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:34.432696Z",
          "iopub.execute_input": "2026-01-02T14:15:34.432800Z",
          "shell.execute_reply": "2026-01-02T14:15:35.226839Z",
          "iopub.status.idle": "2026-01-02T14:15:35.227172Z"
        }
      },
      "outputs": [],
      "execution_count": 1
    },
    "cell_1": {
      "cell_type": "code",
      "source": "N = 1\nM = 2\nE = 2\nenvModel = Environment('MyEnv', E)\nenvName = ['Stage1', 'Stage2']\nenvType = ['UP', 'DOWN']\n\nrate = np.array([[2,1],[1,2]])",
      "metadata": {
        "collapsed": false,
        "ExecuteTime": {
          "end_time": "2025-07-15T22:53:58.259511Z",
          "start_time": "2025-07-15T22:53:58.212950Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:35.228274Z",
          "iopub.execute_input": "2026-01-02T14:15:35.228437Z",
          "shell.execute_reply": "2026-01-02T14:15:35.233674Z",
          "iopub.status.idle": "2026-01-02T14:15:35.234015Z"
        }
      },
      "outputs": [],
      "execution_count": 2
    },
    "cell_2": {
      "cell_type": "code",
      "source": "def renv_genqn(rate, N):\n    # sn1\n    qnet = Network('qn1')\n    \n    node = np.empty(2, dtype=object)\n    node[0] = Delay(qnet, 'Queue1')\n    node[1] = Queue(qnet, 'Queue2', SchedStrategy.PS)\n\n    jobclass = np.empty(1, dtype=object)\n    jobclass[0] = ClosedClass(qnet, 'Class1', N, node[0], 0)\n    \n    node[0].set_service(jobclass[0], Exp(rate[0]))\n    node[1].set_service(jobclass[0], Exp(rate[1]))\n    \n    P = qnet.init_routing_matrix()\n    P.set(jobclass[0],jobclass[0], [[0,1],[1,0]])\n    qnet.link(P)\n    return qnet",
      "metadata": {
        "collapsed": false,
        "ExecuteTime": {
          "end_time": "2025-07-15T22:53:58.445547Z",
          "start_time": "2025-07-15T22:53:58.413920Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:35.235016Z",
          "iopub.execute_input": "2026-01-02T14:15:35.235138Z",
          "shell.execute_reply": "2026-01-02T14:15:35.237190Z",
          "iopub.status.idle": "2026-01-02T14:15:35.237517Z"
        }
      },
      "outputs": [],
      "execution_count": 3
    },
    "cell_3": {
      "cell_type": "code",
      "source": "envSubModel = [renv_genqn(rate[:,0],N), renv_genqn(rate[:,1],N)]\n\nfor e in range(E):\n    envModel.add_stage(e, envName[e], envType[e], envSubModel[e])\n \nenvRates = [[0,1], [0.5,0.5]]\nfor e in range(E):\n    for h in range(E):\n        if envRates[e][h]>0.0:\n            envModel.add_transition(e, h, Exp(envRates[e][h]))",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-15T22:53:58.674610Z",
          "start_time": "2025-07-15T22:53:58.555207Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:35.238414Z",
          "iopub.execute_input": "2026-01-02T14:15:35.238540Z",
          "shell.execute_reply": "2026-01-02T14:15:35.263019Z",
          "iopub.status.idle": "2026-01-02T14:15:35.263344Z"
        }
      },
      "outputs": [],
      "execution_count": 4
    },
    "cell_4": {
      "cell_type": "code",
      "source": "# Display stage table\nprint(\"Stage Table:\")\nenvModel.stage_table()",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-15T22:54:08.006893Z",
          "start_time": "2025-07-15T22:54:07.841024Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:35.264639Z",
          "iopub.execute_input": "2026-01-02T14:15:35.264844Z",
          "shell.execute_reply": "2026-01-02T14:15:35.274800Z",
          "iopub.status.idle": "2026-01-02T14:15:35.275091Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Stage Table:\nStage Table:\n============\nStage 1: Stage1 (Type: UP)\n  - Network: qn1\n  - Nodes: 2\n  - Classes: 1\nStage 2: Stage2 (Type: DOWN)\n  - Network: qn1\n  - Nodes: 2\n  - Classes: 1\n\nTransitions:\n  Stage1 -> Stage2: rate = 1.0000\n  Stage2 -> Stage1: rate = 0.5000\n  Stage2 -> Stage2: rate = 0.5000\n",
            "numerical_values": [
              1.0,
              1.0,
              1.0,
              2.0,
              1.0,
              2.0,
              2.0,
              1.0,
              2.0,
              1.0,
              1.0,
              2.0,
              1.0,
              2.0,
              1.0,
              0.5,
              2.0,
              2.0,
              0.5
            ]
          }
        }
      ],
      "execution_count": 5
    },
    "cell_5": {
      "cell_type": "code",
      "source": "# Configure solver options  \nfrom line_solver import SolverType\noptions = SolverOptions(SolverType.ENV.value)\noptions.timespan = [0, float('inf')]\noptions.iter_max = 100\noptions.iter_tol = 0.01\noptions.method = 'default'\noptions.verbose = True\n\n# Configure fluid solver options\nsfoptions = SolverOptions(SolverType.FLUID.value)\nsfoptions.timespan = [0, 1e3]\nsfoptions.verbose = False\n\n# Create solvers for each submodel\nsolvers = np.empty(E, dtype=object)\nfor e in range(E):\n    solvers[e] = FLD(envSubModel[e], sfoptions)\n\n# Create environment solver\nenvSolver = ENV(envModel, solvers, options)\n\n# Get results\ntry:\n    QN, UN, TN = envSolver.avg()\n    print(\"Average queue lengths (QN):\", QN)\n    print(\"Average utilizations (UN):\", UN)\n    print(\"Average throughputs (TN):\", TN)\n    \n    AvgTable = envSolver.avg_table()\n    print(\"\\nAverage Table:\")\n    print(AvgTable)\n    \nexcept Exception as e:\n    print(f\"Error during solving: {e}\")\n    print(\"Note: Environment solver features may not be fully implemented\")",
      "metadata": {
        "ExecuteTime": {
          "end_time": "2025-07-15T22:55:23.614348Z",
          "start_time": "2025-07-15T22:55:23.499462Z"
        },
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:35.275966Z",
          "iopub.execute_input": "2026-01-02T14:15:35.276076Z",
          "iopub.status.idle": "2026-01-02T14:15:35.307156Z",
          "shell.execute_reply": "2026-01-02T14:15:35.306915Z"
        }
      },
      "outputs": [
        {
          "output_type": "stream",
          "execution_count": null,
          "metadata": {},
          "content": {
            "stream_name": "stdout",
            "text": "Error during solving: 'SolverENV' object has no attribute 'avg'\nNote: Environment solver features may not be fully implemented\n"
          }
        }
      ],
      "execution_count": 6
    },
    "cell_6": {
      "cell_type": "markdown",
      "source": "## Alternative: CTMC Solver (Commented)\nThe MATLAB version also shows an alternative using CTMC, which is commented out in the original.",
      "metadata": {},
      "outputs": [],
      "execution_count": null
    },
    "cell_7": {
      "cell_type": "code",
      "source": "# Alternative solver using CTMC (commented out as in MATLAB version)\n# scoptions = SolverOptions()\n# scoptions.timespan = [0, 1e3]\n# scoptions.verbose = False\n# envSolver = ENV(envModel, lambda model: CTMC(model, scoptions), options)\n# QNc, UNc, TNc = envSolver.avg()\n# AvgTableC = envSolver.avg_table()\n# print(\"CTMC Results:\")\n# print(\"Average Table (CTMC):\", AvgTableC)",
      "metadata": {
        "execution": {
          "iopub.status.busy": "2026-01-02T14:15:35.307945Z",
          "iopub.execute_input": "2026-01-02T14:15:35.308042Z",
          "shell.execute_reply": "2026-01-02T14:15:35.309155Z",
          "iopub.status.idle": "2026-01-02T14:15:35.309374Z"
        }
      },
      "outputs": [],
      "execution_count": 7
    }
  },
  "numerical_summary": {
    "cell_1": [
      1.0,
      2.0,
      2.0,
      1.0,
      2.0,
      2.0,
      1.0,
      1.0,
      2.0
    ],
    "cell_3": [
      0.0,
      1.0,
      0.0,
      1.0,
      0.5,
      0.5,
      0.0
    ],
    "cell_4": [
      1.0,
      1.0,
      1.0,
      2.0,
      1.0,
      2.0,
      2.0,
      1.0,
      2.0,
      1.0,
      1.0,
      2.0,
      1.0,
      2.0,
      1.0,
      0.5,
      2.0,
      2.0,
      0.5
    ],
    "cell_5": [
      0.0,
      100.0,
      0.01,
      0.0,
      1000.0
    ],
    "cell_7": [
      0.0,
      1000.0
    ]
  },
  "metadata": {
    "notebook_path": "randomEnv/renv_twostages_repairmen.ipynb",
    "source_dir": "examples/advanced",
    "total_cells": 8,
    "code_cells": 7,
    "generation_info": {
      "script_version": "2.0",
      "extraction_method": "comprehensive"
    }
  }
}